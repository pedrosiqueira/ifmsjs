<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/highlightjs-svelte/dist/svelte.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
  <script defer>hljs.configure({ languages: ["svelte"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

  <!-- https://github.com/arronhunt/highlightjs-copy -->
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

  <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
  <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
  <script defer>hljs.highlightLinesAll([[], [], [], [], [], [],
    [{ start: 1, end: 1, color: 'lightblue' }, { start: 7, end: 8, color: 'lightgreen' }, { start: 9, end: 13, color: 'lightblue' }],
    [{ start: 1, end: 3, color: 'lightblue' }, { start: 12, end: 17, color: 'lightblue' }],
    [{ start: 13, end: 26, color: 'lightblue' }, { start: 29, end: 32, color: 'lightblue' }],
    [{ start: 8, end: 9, color: 'lightgreen' }, { start: 14, end: 19, color: 'lightblue' }],
    [{ start: 1, end: 1, color: 'lightgreen' }, { start: 5, end: 6, color: 'lightgreen' }, { start: 7, end: 18, color: 'lightblue' }],
    ]);
  </script>

  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body,{delimiters:[{left: '$$', right: '$$', display: true},{left: '$', right: '$', display: false}]});"></script> -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
  <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h2 id="Progressive-enhancement"><span>Progressive enhancement</span><a href="#Progressive-enhancement" class="permalink" aria-label="permalink"></a></h2>
<p>Ao usar <code>&lt;form&gt;</code>, o JavaScript do lado do cliente √© opcional, mas voc√™ pode <em>melhorar progressivamente</em> as intera√ß√µes do formul√°rio com JavaScript para oferecer a melhor experi√™ncia ao usu√°rio.</p>

<h2>Exerc√≠cios</h2>
<ol class="excs">
  <li>√© claro que no momento todos os dados est√£o sendo mantidos na mem√≥ria. </li>
  <li>Atualmente, as senhas est√£o sendo armazenadas em texto puro, o que √© uma grande vulnerabilidade de seguran√ßa. Voc√™ deve usar uma biblioteca como bcrypt para hash de senhas antes de armazen√°-las no banco de dados. </li>
  <li>deslogar no momento precisa manualmente apagar os cookies. implemente o logout</li>
  <li>se est√° logado e tenta acessar a p√°gina de login, permite. implemente l√≥gica para redirecionar caso j√° esteja logado e tente acessar a p√°gina de login.</li>
  <li>ao registrar, l√≥gica de confirmar senha (dois campos de senha).</li>
  <li>L√≥gica de recuperar senha, com redirecionamento.</li>
  <li>adicionar nome do usu√°rio, que deve ter valida√ß√£o como se fosse vari√°vel (sem espa√ßos, letras mai√∫sculas ou caracteres especiais, come√ßando com letras). substituir a rota est√°tica perfil para [perfil], que seja o nome do usu√°rio.</li>
  <li>atualizar usu√°rio</li>
  <li>excluir usu√°rio</li>
  <li>
    5. Preven√ß√£o de Ataques de For√ßa Bruta
    Implemente uma l√≥gica para limitar tentativas de login consecutivas com falha. Por exemplo:

    Bloquear o IP ou o usu√°rio ap√≥s v√°rias tentativas falhas.
    Usar um sistema de "cooldown" para atrasar logins subsequentes.

  </li>
</ol>

<h1>Cookies com SvelteKit</h1>
<h2 id="conceitos">Estado da comunica√ß√£o [me v√™ outro nome para essa se√ß√£o]</h2>
<p>Antes de entrar no assunto de cookies, vamos entender primeiramente por que eles foram inventados, para qu√™ eles s√£o necess√°rios.</p>
<p>Uma comunica√ß√£o entre sistemas pode se dar em v√°rias etapas. √Ä medida que a comunica√ß√£o procede, o "estado" da comunica√ß√£o muda. Portanto, entendamos o "estado" da comunica√ß√£o como "o conjunto de informa√ß√µes que descrevem o contexto atual de uma intera√ß√£o entre cliente e servidor". Em outras palavras: Estado representa quem √© o usu√°rio, o que ele j√° fez, em que etapa est√°, ou qualquer outro dado que o servidor precisa lembrar entre requisi√ß√µes. Isto posto, uma sistema pode ter uma arquitetura stateless ou stateful.</p>
<h3 id="stateless-sem-estado">‚úÖ <strong>Stateless</strong> (Sem estado)</h3>
<p>Um sistema <strong>stateless</strong> n√£o mant√©m informa√ß√µes sobre intera√ß√µes anteriores. Cada requisi√ß√£o √© <strong>independente</strong>, como se fosse a <strong>primeira vez</strong> que o cliente se comunica com o servidor.</p>
<blockquote>
  <p>Exemplo: O protocolo HTTP puro √© stateless. Toda vez que o navegador faz uma requisi√ß√£o, o servidor n√£o sabe quem est√° pedindo a menos que a requisi√ß√£o traga essa informa√ß√£o (como um token ou cookie).</p>
</blockquote>
<hr />
<h3 id="stateful-com-estado">üîÅ <strong>Stateful</strong> (Com estado)</h3>
<p>Um sistema <strong>stateful</strong> <strong>mant√©m informa√ß√µes</strong> sobre intera√ß√µes anteriores. O servidor <strong>lembra do cliente</strong> entre uma requisi√ß√£o e outra, geralmente armazenando isso em uma <strong>sess√£o</strong>.</p>
<blockquote>
  <p>Exemplo: Ap√≥s fazer login em um site, o servidor armazena seus dados em uma sess√£o e sabe que voc√™ est√° autenticado ao navegar pelas p√°ginas.</p>
</blockquote>
<hr />
<h3 id="compara√ß√£o">üìä Compara√ß√£o</h3>
<table border>
  <colgroup>
    <col style="width: 18%" />
    <col style="width: 28%" />
    <col style="width: 53%" />
  </colgroup>
  <thead>
    <tr>
      <th>Caracter√≠stica</th>
      <th>Stateless</th>
      <th>Stateful</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Mant√©m estado?</td>
      <td>‚ùå N√£o</td>
      <td>‚úÖ Sim</td>
    </tr>
    <tr>
      <td>Complexidade no servidor</td>
      <td>‚úÖ Menor</td>
      <td>üî∫ Maior</td>
    </tr>
    <tr>
      <td>Escalabilidade</td>
      <td>‚úÖ Alta (sem estado para gerenciar)</td>
      <td>üîª Menor (estado precisa ser compartilhado entre servidores ou persistido)</td>
    </tr>
    <tr>
      <td>Exemplo na web</td>
      <td>API REST, HTTP puro</td>
      <td>Sess√£o com login, aplica√ß√µes com WebSocket</td>
    </tr>
    <tr>
      <td>Requisi√ß√µes independentes?</td>
      <td>‚úÖ Sim</td>
      <td>‚ùå N√£o (dependem do hist√≥rico)</td>
    </tr>
    <tr>
      <td>Armazenamento de sess√£o</td>
      <td>‚ùå Cliente envia tudo o que √© necess√°rio</td>
      <td>‚úÖ Servidor armazena dados da sess√£o</td>
    </tr>
  </tbody>
</table border>
<hr />
<h3 id="quando-usar-cada-um">üß© Quando usar cada um?</h3>
<table border>
  <thead>
    <tr>
      <th>Situa√ß√£o</th>
      <th>Recomendado</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>APIs REST modernas</td>
      <td>Stateless</td>
    </tr>
    <tr>
      <td>Aplica√ß√µes com autentica√ß√£o simples</td>
      <td>Stateful</td>
    </tr>
    <tr>
      <td>Sistemas distribu√≠dos com m√∫ltiplos servidores</td>
      <td>Stateless</td>
    </tr>
    <tr>
      <td>Aplica√ß√µes interativas e tempo real</td>
      <td>Stateful (ex: WebSockets)</td>
    </tr>
  </tbody>
</table border>
<hr />
<h2 id="o-que-s√£o-cookies">üç™ O que s√£o Cookies?</h2>
<p><strong>Cookies</strong> s√£o pequenos arquivos de texto que os navegadores armazenam localmente no dispositivo do usu√°rio, a pedido de um servidor web. Eles servem para guardar informa√ß√µes √∫teis entre diferentes requisi√ß√µes HTTP ‚Äî que, por padr√£o, s√£o <em>stateless</em> (sem estado).</p>
<p>Ou seja, sem cookies (ou outros mecanismos de armazenamento), cada requisi√ß√£o seria como se fosse feita por um visitante completamente novo.</p>
<hr />
<h2 id="para-que-servem">üß† Para que servem?</h2>
<p>Cookies podem ser usados para diversas finalidades, incluindo:</p>
<ul>
  <li><strong>Autentica√ß√£o</strong>: manter o usu√°rio logado ap√≥s o login.</li>
  <li><strong>Prefer√™ncias do usu√°rio</strong>: tema escuro, idioma preferido, etc.</li>
  <li><strong>Carrinhos de compras</strong>: guardar os itens entre visitas.</li>
  <li><strong>Analytics e rastreamento</strong>: medir o comportamento do usu√°rio (ex: Google Analytics).</li>
  <li><strong>Personaliza√ß√£o</strong>: mostrar conte√∫do personalizado com base em visitas anteriores.</li>
</ul>
<hr />
<h2 id="como-funcionam">üõ† Como funcionam?</h2>
<h3 id="envio-pelo-servidor">1. Envio pelo servidor</h3>
<p>O servidor envia um cookie para o navegador usando o cabe√ßalho HTTP <code>Set-Cookie</code>. Exemplo:</p>
<pre><code>Set-Cookie: sessionId=abc123; HttpOnly; Path=/; Max-Age=3600</code></pre>
<p>Esse cookie ser√° armazenado pelo navegador e inclu√≠do automaticamente em cada requisi√ß√£o subsequente ao mesmo dom√≠nio (ou caminho correspondente).</p>
<h3 id="envio-pelo-navegador">2. Envio pelo navegador</h3>
<p>Sempre que o navegador fizer uma nova requisi√ß√£o ao servidor, ele incluir√° todos os cookies v√°lidos no cabe√ßalho <code>Cookie</code>:</p>
<pre><code>Cookie: sessionId=abc123</code></pre>
<hr />
<h2 id="atributos-importantes-de-um-cookie">üîê Atributos importantes de um cookie</h2>
<table border>
  <colgroup>
    <col style="width: 13%" />
    <col style="width: 86%" />
  </colgroup>
  <thead>
    <tr>
      <th>Atributo</th>
      <th>Descri√ß√£o</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Name=Value</code></td>
      <td>Nome e valor do cookie. Obrigat√≥rio.</td>
    </tr>
    <tr>
      <td><code>Path</code></td>
      <td>Define em qual caminho o cookie √© enviado. Ex: <code>/</code>, <code>/admin</code>.</td>
    </tr>
    <tr>
      <td><code>Domain</code></td>
      <td>Restringe o cookie a um subdom√≠nio (ex: <code>.meusite.com</code>).</td>
    </tr>
    <tr>
      <td><code>Expires</code></td>
      <td>Data e hora em que o cookie expira.</td>
    </tr>
    <tr>
      <td><code>Max-Age</code></td>
      <td>Tempo de vida em segundos (preferido ao inv√©s de <code>Expires</code>).</td>
    </tr>
    <tr>
      <td><code>HttpOnly</code></td>
      <td>Impede acesso via JavaScript (aumenta seguran√ßa contra XSS).</td>
    </tr>
    <tr>
      <td><code>Secure</code></td>
      <td>Envia o cookie apenas em conex√µes HTTPS.</td>
    </tr>
    <tr>
      <td><code>SameSite</code></td>
      <td>Controla o envio em requisi√ß√µes cross-site. Pode ser <code>Strict</code>, <code>Lax</code> ou <code>None</code>.</td>
    </tr>
  </tbody>
</table border>
<p>Acesse as ferramentas de desenvolvimento do teu navegador, ‚Üí..., e verifique os cookies para a p√°gina atualmente aberta.</p>
<hr />
<h2 id="diferen√ßa-entre-cookies-de-sess√£o-e-persistentes">üí° Tipos de Cookies</h2>
<p>Podemos comparar os cookies quanto √† durabilidade.</p>
<table border>
  <thead>
    <tr>
      <th>Tipo</th>
      <th>Dura√ß√£o</th>
      <th>Onde √© usado</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>De Sess√£o</strong></td>
      <td>At√© o navegador fechar</td>
      <td>Login tempor√°rio, sess√£o an√¥nima. [me d√™ mais exemplos]</td>
    </tr>
    <tr>
      <td><strong>Persistentes</strong></td>
      <td>At√© expirar (<code>Max-Age</code> ou <code>Expires</code>)</td>
      <td>‚ÄúLembrar de mim‚Äù, carrinhos. [me d√™ mais exemplos]</td>
    </tr>
  </tbody>
</table border>
<p>Tamb√©m podemos separar os cookies por que tipo de servidor os utiliza.</p>
<table border>
  <thead>
    <tr>
      <th>Tipo</th>
      <th>?</th>
      <th>?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>?</strong></td>
      <td>? cookies are set by the website that you are currently visiting</td>
      <td>? cookies are generally used to provide a good user experience, collect the analytics data, remember language settings etc. [reformule] </td>
    </tr>
    <tr>
      <td><strong>Cookies de terceiros</strong></td>
      <td>Third-party cookies are set by the domains that you are not visiting</td>
      <td>Third-party cookies are mostly used for cross-site tracking and advertising purposes these cookies collect data about your browsing habits and serve ads according to it. For example, when you visit a website, it may include content (such as ads or social media widgets) from third-party domains. These third-party domains can set cookies on your browser to track your online activity and build profiles for targeted advertising or analytics. [reformule]</td>
    </tr>
  </tbody>
</table border>
<hr />
<h2 id="considera√ß√µes-de-seguran√ßa">‚ö†Ô∏è Considera√ß√µes de Seguran√ßa</h2>
<ol type="1">
  <li>
    <p><strong>HttpOnly</strong>: Protege contra ataques XSS (impede acesso via JavaScript).</p>
  </li>
  <li>
    <p><strong>Secure</strong>: Evita envio de cookies por HTTP n√£o seguro.</p>
  </li>
  <li>
    <p><strong>SameSite</strong>:</p>
    <ul>
      <li><code>Strict</code>: s√≥ envia o cookie em requisi√ß√µes do mesmo site.</li>
      <li><code>Lax</code>: permite algumas requisi√ß√µes cross-site (como cliques em links).</li>
      <li><code>None</code>: permite tudo, mas exige <code>Secure</code>.</li>
    </ul>
  </li>
  <li>
    <p><strong>Cookies n√£o s√£o criptografados por padr√£o</strong>. Se armazenar dados sens√≠veis, √© necess√°rio criptograf√°-los.</p>
  </li>
</ol>
<hr />
<h2>How do cookies affect privacy?</h2>
<p>adaptador <a href="https://www.geeksforgeeks.org/understanding-cookies-in-web-browsers/">daqui</a> </p>
<p>Cookies can have both positive and negative effects on privacy:</p>

<p>Positive: Cookies can enhance user experiences by remembering preferences and login information, making websites more user-friendly.</p>

<p>Negative: Cookies can raise privacy concerns when they are used for tracking and profiling without user consent. Excessive tracking can result in a loss of online privacy and the potential for data misuse.</p>
<hr>
<h2 id="cookies-no-sveltekit">üçÉ Cookies no SvelteKit</h2>
<p>No SvelteKit, voc√™ pode acessar e manipular cookies usando objetos como <code>event.cookies</code> dentro de <code>+page.server.js</code>, <code>+layout.server.js</code>, ou <code>hooks.server.js</code>.</p>
<h3 id="lendo-cookies">‚úÖ Lendo cookies:</h3>
<div class="sourceCode" id="cb3">
  <pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="im">export</span> <span class="kw">const</span> load <span class="op">=</span> <span class="kw">async</span> ({ cookies }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  <span class="kw">const</span> theme <span class="op">=</span> cookies<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;theme&#39;</span>) <span class="op">||</span> <span class="st">&#39;light&#39;</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  <span class="cf">return</span> { theme }<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre>
</div>
<h3 id="gravando-cookies">‚úÖ Gravando cookies:</h3>
<div class="sourceCode" id="cb4">
  <pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="im">export</span> <span class="kw">const</span> actions <span class="op">=</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  <span class="dt">setTheme</span><span class="op">:</span> <span class="kw">async</span> ({ request<span class="op">,</span> cookies }) <span class="kw">=&gt;</span> {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> request<span class="op">.</span><span class="fu">formData</span>()<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">const</span> theme <span class="op">=</span> data<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;theme&#39;</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>    cookies<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;theme&#39;</span><span class="op">,</span> theme<span class="op">,</span> {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>      <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">30</span>  <span class="co">// 30 dias</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    })<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  }</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre>
</div>
<h3 id="removendo-cookies">‚úÖ Removendo cookies:</h3>
<div class="sourceCode" id="cb5">
  <pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>cookies<span class="op">.</span><span class="fu">delete</span>(<span class="st">&#39;theme&#39;</span><span class="op">,</span> { <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/&#39;</span> })<span class="op">;</span></span></code></pre>
</div>
<hr />
<h2 id="cookies-vs.-alternativas">üì¶ Cookies vs.¬†Alternativas</h2>
<p>Al√©m de cookies, existem outras formas de armazenamento no navegador:</p>
<table border>
  <thead>
    <tr>
      <th>Tecnologia</th>
      <th>Vis√≠vel no JS?</th>
      <th>Expira?</th>
      <th>Envio autom√°tico ao servidor?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Cookies</td>
      <td>Se n√£o for <code>HttpOnly</code></td>
      <td>Sim</td>
      <td>Sim</td>
    </tr>
    <tr>
      <td>localStorage</td>
      <td>Sim</td>
      <td>N√£o (permanece)</td>
      <td>N√£o</td>
    </tr>
    <tr>
      <td>sessionStorage</td>
      <td>Sim</td>
      <td>Ao fechar aba</td>
      <td>N√£o</td>
    </tr>
    <tr>
      <td>IndexedDB</td>
      <td>Sim</td>
      <td>N√£o</td>
      <td>N√£o</td>
    </tr>
  </tbody>
</table border>
<p>Use cookies quando <strong>precisar que o servidor leia os dados</strong> em cada requisi√ß√£o. Para demais casos, use <code>localStorage</code> ou <code>sessionStorage</code>.</p>
<hr />
<h2 id="conclus√£o">‚úÖ Conclus√£o</h2>
<p>Cookies s√£o essenciais para dar ‚Äúmem√≥ria‚Äù √†s aplica√ß√µes web. Usados corretamente, eles possibilitam autentica√ß√£o, personaliza√ß√£o e muito mais. No entanto, seu uso deve ser cuidadoso, respeitando boas pr√°ticas de seguran√ßa (como <code>HttpOnly</code>, <code>Secure</code> e <code>SameSite</code>) e privacidade do usu√°rio.</p>
<hr />