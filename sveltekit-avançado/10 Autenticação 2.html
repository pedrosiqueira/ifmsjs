<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/highlightjs-svelte/dist/svelte.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
  <script defer>hljs.configure({ languages: ["svelte"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

  <!-- https://github.com/arronhunt/highlightjs-copy -->
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

  <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
  <!-- <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
  <script defer>hljs.highlightLinesAll([[], [], [{ start: 2, end: 2, color: 'lightblue' }]]);</script> -->

  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body,{delimiters:[{left: '$$', right: '$$', display: true},{left: '$', right: '$', display: false}]});"></script> -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
  <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h1>Cookies com SvelteKit</h1>

<h2 id="gerenciamento-estado">Gerenciamento de Estado na Web</h2>
<p>Antes de entrar no assunto de cookies, vamos entender primeiramente por que eles foram inventados, para qu√™ eles s√£o necess√°rios.</p>
<p>Uma comunica√ß√£o entre sistemas pode se dar em v√°rias etapas. √Ä medida que a comunica√ß√£o procede, o "estado" da comunica√ß√£o muda. Portanto, entendamos o "estado" da comunica√ß√£o como "o conjunto de informa√ß√µes que descrevem o contexto atual de uma intera√ß√£o entre cliente e servidor". Em outras palavras: Estado representa quem √© o usu√°rio, o que ele j√° fez, em que etapa est√°, ou qualquer outro dado que o servidor precisa lembrar entre requisi√ß√µes. Isto posto, uma sistema pode ter uma arquitetura stateless ou stateful.</p>

<h3 id="stateless">‚úÖ Stateless (Sem Estado)</h3>
<p>Um sistema <strong>stateless</strong> n√£o mant√©m informa√ß√µes sobre intera√ß√µes anteriores. Cada requisi√ß√£o √© <strong>independente</strong>, como se fosse a <strong>primeira vez</strong> que o cliente se comunica com o servidor.</p>
<p>Exemplo: O protocolo HTTP puro √© stateless. A cada requisi√ß√£o, o servidor n√£o reconhece o cliente, a menos que a requisi√ß√£o traga algum identificador (token, cookie etc.).</p>

<h3 id="stateful">üîÅ Stateful (Com Estado)</h3>
<p>Um sistema <strong>stateful</strong> <strong>mant√©m informa√ß√µes</strong> sobre intera√ß√µes anteriores. O servidor <strong>lembra do cliente</strong> entre uma requisi√ß√£o e outra, geralmente armazenando isso em uma <strong>sess√£o</strong>.</p>
<p>Exemplo: Ap√≥s fazer login em um site, o servidor armazena seus dados em uma sess√£o e sabe que voc√™ est√° autenticado ao navegar pelas p√°ginas.</p>

<h3 id="comparacao-estado">üìä Compara√ß√£o</h3>
<table border>
  <thead>
    <tr>
      <th>Caracter√≠stica</th>
      <th>Stateless</th>
      <th>Stateful</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Mant√©m estado?</td>
      <td>‚ùå N√£o</td>
      <td>‚úÖ Sim</td>
    </tr>
    <tr>
      <td>Complexidade no servidor</td>
      <td>‚úÖ Baixa</td>
      <td>üî∫ Alta</td>
    </tr>
    <tr>
      <td>Escalabilidade</td>
      <td>‚úÖ Alta (sem estado para gerenciar)</td>
      <td>üîª Menor (estado precisa ser compartilhado entre servidores ou persistido)</td>
    </tr>
    <tr>
      <td>Exemplos</td>
      <td>APIs REST, HTTP puro</td>
      <td>Sites com login, WebSockets</td>
    </tr>
    <tr>
      <td>Requisi√ß√µes independentes?</td>
      <td>‚úÖ Sim</td>
      <td>‚ùå N√£o</td>
    </tr>
    <tr>
      <td>Armazenamento de sess√£o</td>
      <td>‚ùå Cliente envia tudo o que √© necess√°rio</td>
      <td>‚úÖ Servidor armazena dados da sess√£o</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="o-que-sao-cookies">üç™ O que s√£o Cookies?</h2>
<p><strong>Cookies</strong> s√£o pequenos arquivos de texto que os navegadores armazenam localmente no dispositivo do usu√°rio, a pedido de um servidor web. Eles servem para guardar informa√ß√µes √∫teis entre diferentes requisi√ß√µes HTTP ‚Äî que, por padr√£o, s√£o <em>stateless</em> (sem estado).</p>
<p>Ou seja, sem cookies (ou outros mecanismos de armazenamento), cada requisi√ß√£o seria como se fosse feita por um visitante completamente novo.</p>

<h3 id="para-que-servem">üß† Para que servem?</h3>
<p>Cookies podem ser usados para diversas finalidades, incluindo:</p>
<ul>
  <li><strong>Autentica√ß√£o</strong>: manter usu√°rio logado.</li>
  <li><strong>Prefer√™ncias</strong>: tema, idioma, layout.</li>
  <li><strong>Carrinho de compras</strong>: itens persistentes.</li>
  <li><strong>Analytics</strong>: rastrear o comportamento do usu√°rio.</li>
  <li><strong>Personaliza√ß√£o</strong>: conte√∫dos personalizados (marketing).</li>
</ul>

<h3 id="como-funcionam">üõ† Como funcionam?</h3>

<p>O servidor envia um cookie para o navegador usando o cabe√ßalho HTTP <code>Set-Cookie</code>. Exemplo:</p>
<pre><code>Set-Cookie: sessionId=abc123; HttpOnly; Path=/; Max-Age=3600</code></pre>
<p>Esse cookie ser√° armazenado pelo navegador e inclu√≠do automaticamente em cada requisi√ß√£o subsequente ao mesmo dom√≠nio (ou caminho correspondente).</p>
<h3 id="envio-pelo-navegador">2. Envio pelo navegador</h3>
<p>Sempre que o navegador fizer uma nova requisi√ß√£o ao servidor, ele incluir√° todos os cookies v√°lidos no cabe√ßalho <code>Cookie</code>:</p>
<pre><code>Cookie: sessionId=abc123</code></pre>

<h3 id="atributos-cookie">üîê Atributos importantes de um cookie</h3>
<table border>
  <thead>
    <tr>
      <th>Atributo</th>
      <th>Descri√ß√£o</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Name=Value</code></td>
      <td>Nome e valor do cookie. Obrigat√≥rio.</td>
    </tr>
    <tr>
      <td><code>Path</code></td>
      <td>Define em qual caminho o cookie √© enviado. Ex: <code>/</code>, <code>/admin</code>.</td>
    </tr>
    <tr>
      <td><code>Domain</code></td>
      <td>Restringe o cookie a um subdom√≠nio (ex: <code>.meusite.com</code>).</td>
    </tr>
    <tr>
      <td><code>Expires</code></td>
      <td>Data e hora em que o cookie expira.</td>
    </tr>
    <tr>
      <td><code>Max-Age</code></td>
      <td>Tempo de vida em segundos (preferido ao inv√©s de <code>Expires</code>).</td>
    </tr>
    <tr>
      <td><code>HttpOnly</code></td>
      <td>Impede acesso via JavaScript (aumenta seguran√ßa contra XSS).</td>
    </tr>
    <tr>
      <td><code>Secure</code></td>
      <td>Envia o cookie apenas em conex√µes HTTPS.</td>
    </tr>
    <tr>
      <td><code>SameSite</code></td>
      <td>Controla o envio em requisi√ß√µes cross-site. Pode ser <code>Strict</code>, <code>Lax</code> ou <code>None</code>.</td>
    </tr>
  </tbody>
</table>

<div class="info">
  <p>Dica: Acesse as ferramentas de desenvolvimento do teu navegador, ‚Üí..., e verifique os cookies de alguma p√°gina!</p>
</div>

<h3 id="tipos-de-cookies">üí° Tipos de Cookies</h3>
<p>Podemos comparar os cookies quanto √† durabilidade:</p>
<table border>
  <thead>
    <tr>
      <th>Tipo</th>
      <th>Dura√ß√£o</th>
      <th>Uso Comum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>De Sess√£o</strong></td>
      <td>At√© fechar o navegador</td>
      <td>Login tempor√°rio, sess√£o an√¥nima. [me d√™ mais exemplos]</td>
    </tr>
    <tr>
      <td><strong>Persistentes</strong></td>
      <td>At√© expirar (<code>Max-Age</code> ou <code>Expires</code>)</td>
      <td>‚ÄúLembrar de mim‚Äù, carrinhos, prefer√™ncias de tema</td>
    </tr>
  </tbody>
</table>

<p>Tamb√©m podemos separar os cookies por que tipo de servidor os utiliza:</p>

<table border>
  <thead>
    <tr>
      <th>Tipo</th>
      <th>Descri√ß√£o</th>
      <th>Uso Comum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Pr√≥prios</strong></td>
      <td>? cookies are set by the website that you are currently visiting</td>
      <td>? cookies are generally used to provide a good user experience, collect the analytics data, remember language settings etc. [reformule] </td>
    </tr>
    <tr>
      <td><strong>De terceiros</strong></td>
      <td>Definido por dom√≠nios externos (ads, widgets)</td>
      <td>Third-party cookies are mostly used for cross-site tracking and advertising purposes these cookies collect data about your browsing habits and serve ads according to it. For example, when you visit a website, it may include content (such as ads or social media widgets) from third-party domains. These third-party domains can set cookies on your browser to track your online activity and build profiles for targeted advertising or analytics. [reformule]</td>
    </tr>
  </tbody>
</table>

<h3 id="seguranca">‚ö†Ô∏è Boas Pr√°ticas de Seguran√ßa</h3>
<ol>
  <li><strong>HttpOnly</strong>: Protege contra ataques XSS (impede acesso via JavaScript).</li>
  <li><strong>Secure</strong>: Evita envio de cookies por HTTP n√£o seguro.</li>
  <li><strong>SameSite</strong>:
    <ul>
      <li><code>Strict</code>: S√≥ envia o cookie em requisi√ß√µes do mesmo site.</li>
      <li><code>Lax</code>: Permite algumas requisi√ß√µes cross-site (como cliques em links).</li>
      <li><code>None</code>: Permite tudo, mas exige <code>Secure</code>.</li>
    </ul>
  </li>
  <li><strong>Cookies n√£o s√£o criptografados por padr√£o</strong>. Se armazenar dados sens√≠veis, √© necess√°rio criptograf√°-los.</li>
</ol>

<h3>How do cookies affect privacy?</h3>
<p>adaptador <a href="https://www.geeksforgeeks.org/understanding-cookies-in-web-browsers/">daqui</a> </p>
<p>Cookies can have both positive and negative effects on privacy:</p>

<p>Positive: Cookies can enhance user experiences by remembering preferences and login information, making websites more user-friendly.</p>

<p>Negative: Cookies can raise privacy concerns when they are used for tracking and profiling without user consent. Excessive tracking can result in a loss of online privacy and the potential for data misuse.</p>

<h3 id="alternativas">üì¶ Cookies vs Alternativas</h3>
<p>Al√©m de cookies, existem outras formas de armazenamento no navegador:</p>
<table border>
  <thead>
    <tr>
      <th>Tecnologia</th>
      <th>Vis√≠vel no JS?</th>
      <th>Expira?</th>
      <th>Envio autom√°tico ao servidor?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Cookies</td>
      <td>Sim (se n√£o for HttpOnly)</td>
      <td>Sim</td>
      <td>Sim</td>
    </tr>
    <tr>
      <td>localStorage</td>
      <td>Sim</td>
      <td>N√£o</td>
      <td>N√£o</td>
    </tr>
    <tr>
      <td>sessionStorage</td>
      <td>Sim</td>
      <td>Ao fechar aba</td>
      <td>N√£o</td>
    </tr>
    <tr>
      <td>IndexedDB</td>
      <td>Sim</td>
      <td>N√£o</td>
      <td>N√£o</td>
    </tr>
  </tbody>
</table>
<p>Use cookies quando <strong>precisar que o servidor leia os dados</strong> em cada requisi√ß√£o. Para demais casos, use <code>localStorage</code> ou <code>sessionStorage</code>.</p>

<h3 id="conclus√£o">‚úÖ Conclus√£o</h3>
<p>Cookies s√£o essenciais para dar ‚Äúmem√≥ria‚Äù aos aplicativos web. Usados corretamente, eles possibilitam autentica√ß√£o, personaliza√ß√£o e muito mais. No entanto, seu uso deve ser cuidadoso, respeitando boas pr√°ticas de seguran√ßa (como <code>HttpOnly</code>, <code>Secure</code> e <code>SameSite</code>) e privacidade do usu√°rio.</p>
<hr />

<h2 id="cookies-no-sveltekit">üçÉ Cookies no SvelteKit</h2>
<p>No SvelteKit, use <code>event.cookies</code> em <code>+page.server.js</code>, <code>+layout.server.js</code> ou <code>hooks.server.js</code>:</p>

<h3>Leitura</h3>
<pre><code class="js">export const load = async ({ cookies }) =&gt; {
  const theme = cookies.get('theme') || 'light';
  return { theme };
};</code></pre>

<h3>Grava√ß√£o</h3>
<pre><code class="js">export const actions = {
  setTheme: async ({ request, cookies }) =&gt; {
    const data = await request.formData();
    const theme = data.get('theme');
    cookies.set('theme', theme, {
      path: '/',
      maxAge: 60 * 60 * 24 * 30 // 30 dias
    });
  }
};</code></pre>

<h3>Remo√ß√£o</h3>
<pre><code class="js">cookies.delete('theme', { path: '/' });</code></pre>