<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/highlightjs-svelte/dist/svelte.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
  <script defer>hljs.configure({ languages: ["svelte"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

  <!-- https://github.com/arronhunt/highlightjs-copy -->
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

  <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
  <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
  <script defer>hljs.highlightLinesAll([[], [], [], [], [], [],
    [{ start: 1, end: 1, color: 'lightblue' }, { start: 7, end: 8, color: 'lightgreen' }, { start: 9, end: 13, color: 'lightblue' }],
    [{ start: 1, end: 3, color: 'lightblue' }, { start: 14, end: 19, color: 'lightblue' }],
    [{ start: 13, end: 21, color: 'lightblue' }, { start: 24, end: 27, color: 'lightblue' }],
    [{ start: 8, end: 9, color: 'lightgreen' }, { start: 14, end: 19, color: 'lightblue' }],
    [{ start: 1, end: 1, color: 'lightgreen' }, { start: 5, end: 6, color: 'lightgreen' }, { start: 7, end: 18, color: 'lightblue' }],
    ]);
  </script>

  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body,{delimiters:[{left: '$$', right: '$$', display: true},{left: '$', right: '$', display: false}]});"></script> -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
  <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h1>A√ß√µes de Formul√°rio</h1>
<sub><a target="_blank" href="https://svelte.dev/docs/kit/form-actions">Adaptado daqui</a>.</sub>

<p>No cap√≠tulo <a target="_blank" href="./03 Carregando dados do servidor.html">Carregando dados do servidor</a>, vimos como enviar dados do servidor para o navegador. Muitas vezes, √© necess√°rio fazer o inverso ‚Äî enviar dados do navegador para o servidor. Para isso, utilizamos o elemento <code>&lt;form&gt;</code>, o principal recurso da plataforma web para esse tipo de comunica√ß√£o.</p>

<p>Um arquivo <code>+page.server.js</code> pode exportar <em>a√ß√µes</em>, permitindo o envio de dados ao servidor por meio de um formul√°rio que utiliza o m√©todo <code>POST</code>.</p>

<h2 id="Default-actions">A√ß√µes padr√£o</h2>

<p>Crie o arquivo <code ctc>src/routes/04/a/+page.svelte</code>:</p>

<pre><code>&lt;h4&gt;Um formul√°rio&lt;/h4&gt;
&lt;form method="POST"&gt;
  &lt;input name="umtexto" placeholder="Digite um texto" /&gt;
  &lt;input name="outrotexto" placeholder="Digite outro texto" /&gt;
  &lt;button&gt;Submeter&lt;/button&gt;
&lt;/form&gt;</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Ao submeter um formul√°rio, ele √© enviado ao servidor pela URL definida no atributo <code>action</code>.</li>
  <li>Como neste caso o atributo <code>action</code> n√£o foi especificado, o formul√°rio ser√° enviado para a URL atual da p√°gina.</li>
</ul>

<p>Crie tamb√©m o arquivo <code ctc>src/routes/04/a/+page.server.js</code>:</p>

<pre><code>export const actions = {
  default: async (event) =&gt; {
    console.log(event);
    console.log(await event.request.formData());
  }
};</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>A fun√ß√£o <code>default</code> ser√° executada sempre que houver uma requisi√ß√£o <code>POST</code> para a rota <code>/04/a</code>, como no exemplo do formul√°rio acima.</li>
  <li>O par√¢metro <code>event</code> √© um objeto <a target="_blank" href="https://svelte.dev/docs/kit/@sveltejs-kit#RequestEvent">RequestEvent</a>, que fornece informa√ß√µes detalhadas sobre a requisi√ß√£o.</li>
  <li>Como vimos no <a target="_blank" href="./03 Carregando dados do servidor.html#serverloadevent">cap√≠tulo anterior</a>, a fun√ß√£o <code>load</code> recebe um objeto <a target="_blank" href="https://svelte.dev/docs/kit/@sveltejs-kit#ServerLoadEvent">ServerLoadEvent</a>, que herda os m√©todos de <code>RequestEvent</code>. Por isso, voc√™ j√° deve estar familiarizado com propriedades como <code>params</code>, <code>url</code> e <code>fetch</code>, dispon√≠veis tanto em a√ß√µes de formul√°rio quanto na fun√ß√£o <code>load</code>.</li>
  <li>Linha 3: Imprimimos o objeto <code>event</code> no terminal do servidor, para fins de teste.</li>
  <li>Linha 4: Para acessar os dados enviados pelo formul√°rio, utilizamos o m√©todo ass√≠ncrono <code>formData()</code> do objeto <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Request"><code>request</code></a>, que √© uma propriedade de <code>event</code>.</li>
</ul>

<div class="info">
  <p><strong>Observa√ß√£o:</strong> A√ß√µes sempre utilizam requisi√ß√µes <code>POST</code>, pois requisi√ß√µes <code>GET</code> n√£o devem causar efeitos colaterais.</p>
</div>

<p>Tamb√©m √© poss√≠vel enviar dados para outra rota informando o atributo <code>action</code> com a URL de destino.</p>

<p>Crie o arquivo <code ctc>src/routes/04/b/+page.svelte</code>:</p>

<pre><code>&lt;h4&gt;Outro formul√°rio&lt;/h4&gt;
&lt;form method="POST" action="/04/a"&gt;
  &lt;input type="number" placeholder="Digite um n√∫mero" /&gt;
  &lt;input name="umadata" type="date" /&gt;
  &lt;button&gt;Submeter&lt;/button&gt;
&lt;/form&gt;</code></pre>

<p>Explica√ß√£o:</p>
<p>Ao incluir o atributo <code>action</code>, este formul√°rio envia os dados para a rota <code>/04/a</code>, onde ser√£o processados pela a√ß√£o padr√£o dessa p√°gina.</p>

<div class="info">
  <p><strong>Observa√ß√£o:</strong> Cada campo do formul√°rio precisa ter o atributo <code>name</code> para que seus dados sejam inclu√≠dos na requisi√ß√£o enviada ao servidor.</p>
</div>

<p>√ìtimo! Agora temos um meio eficiente de trocar dados entre p√°ginas!</p>

<h2 id="Named-actions">A√ß√µes nomeadas</h2>

<p>Em vez de usar apenas a a√ß√£o <code>default</code>, uma p√°gina pode conter m√∫ltiplas a√ß√µes nomeadas.</p>

<p>Crie o arquivo <code ctc>src/routes/04/login/+page.server.js</code>:</p>

<pre><code>export const actions = {
  login: async () => {
    console.log('Autenticando...');
  },
  register: async () => {
    console.log('Registrando...');
  }
};</code></pre>

<p>Explica√ß√£o:</p>
<p>Neste exemplo, simulamos duas a√ß√µes distintas: <code>login</code> e <code>register</code>.</p>

<p>Para invocar uma a√ß√£o nomeada, usamos um par√¢metro de consulta no atributo <code>action</code>, come√ßando com <code>?/</code> seguido do nome da a√ß√£o.</p>

<p>Crie o arquivo <code ctc>src/routes/04/login/+page.svelte</code>:</p>

<pre><code>&lt;h1&gt;Entrada / Registro&lt;/h1&gt;

&lt;form method="POST" action="?/login"&gt;
  &lt;label&gt;Email &lt;input name="email" type="email" value={form?.email || ''} required /&gt;&lt;/label&gt;
  &lt;label&gt;Senha &lt;input name="password" type="password" required /&gt;&lt;/label&gt;
  &lt;button&gt;Entrar&lt;/button&gt;
  &lt;button formaction="?/register"&gt;Registrar&lt;/button&gt;
&lt;/form&gt;</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Linha 1: O formul√°rio principal ser√° enviado para a a√ß√£o nomeada <code>login</code>.</li>
  <li>Linha 5: O bot√£o <code>Registrar</code> usa o atributo <code>formaction</code> para enviar o mesmo formul√°rio √† a√ß√£o <code>register</code>, substituindo o <code>action</code> do formul√°rio.</li>
</ul>

<div class="info">
  <p><strong>Aten√ß√£o:</strong> n√£o √© recomend√°vel combinar a√ß√£o padr√£o com a√ß√µes nomeadas na mesma p√°gina. Isso porque, se voc√™ fizer um <code>POST</code> para uma a√ß√£o nomeada que n√£o redireciona, o par√¢metro de consulta (ex: <code>?/login</code>) permanece na URL. Assim, uma pr√≥xima submiss√£o para a a√ß√£o padr√£o continuar√° sendo tratada pela √∫ltima a√ß√£o nomeada, o que pode causar comportamentos inesperados.</p>
</div>

<h2>Retornando dados</h2>
<p>Ap√≥s processar a requisi√ß√£o (por exemplo, registrando o usu√°rio), a a√ß√£o pode retornar dados que ficam dispon√≠veis por meio da propriedade <code>form</code> na p√°gina correspondente e tamb√©m em <code>page.form</code> em todo o aplicativo, at√© a pr√≥xima atualiza√ß√£o de p√°gina.</p>
<p>Crie o arquivo <code ctc>src/lib/server/usersDatabase.js</code>:</p>
<pre><code>const users = new Map();

export function create(email, password) {
  if (users.has(email)) throw new Error('Email j√° cadastrado');

  if (email == 'email@proibido') throw new Error('Isso n√£o √© pra usu√°rios... üòé');

  users.set(email, { email, password });
}

export function read(email) {
  return users.get(email);
}</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Esse arquivo representa nosso banco de dados de usu√°rios. No momento, as duas √∫nicas opera√ß√µes dispon√≠veis s√£o <code>create</code> e <code>read</code>.</li>
  <li>Linha 3: A fun√ß√£o <code>create(email, password)</code> adiciona um novo usu√°rio ao banco.</li>
  <li>Linha 4: Se j√° houver um usu√°rio com o mesmo email, um erro √© lan√ßado.</li>
  <li>Linha 6: Um pequeno easter egg para for√ßar um erro de servidor em um teste futuro.</li>
  <li>Linha 8: Armazena o novo usu√°rio no mapa <code>users</code>.</li>
  <li>Linha 11: A fun√ß√£o <code>read(email)</code> retorna o usu√°rio correspondente ou <code>undefined</code> caso n√£o exista.</li>
</ul>
<div class="info">Aten√ß√£o: Esse √© um banco de dados apenas para fins did√°ticos! Em um sistema real, os dados devem ser armazenados em um banco de dados apropriado. E o mais importante: AS SENHAS NUNCA DEVEM SER SALVAS EM TEXTO PURO!!!</div>

<p>Agora, altere a fun√ß√£o <code>register</code> no arquivo <code ctc>src/routes/04/login/+page.server.js</code> (em azul os acr√©scimos, em verde as modifica√ß√µes):</p>
<pre><code>import * as users from '$lib/server/usersDatabase.js';

export const actions = {
  login: async () => {
    console.log('Autenticando...');
  },
  register: async ({ request }) => {
    const data = await request.formData();
    const email = data.get('email');
    const password = data.get('password');

    users.create(email, password);
    return { success: true, msg: 'Usu√°rio registrado com sucesso! Agora voc√™ pode fazer o login...' };
  }
};</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Linha 7: Utilizamos apenas a propriedade <code>request</code> do objeto <code>event</code>.</li>
  <li>Linhas 8‚Äì10: Extra√≠mos o email e a senha enviados pelo formul√°rio.</li>
  <li>Linha 12: Adicionamos o novo usu√°rio ao banco.</li>
  <li>Linha 13: Assim como os dados retornados por <code>load</code> <a target="_blank" href="./03 Carregando dados do servidor.html#load-return">ficam dispon√≠veis</a> na propriedade <code>data</code>, os dados retornados por uma a√ß√£o de formul√°rio ficam dispon√≠veis na propriedade <code>form</code>.</li>
  <li>A l√≥gica de registro ainda est√° incompleta: n√£o validamos os dados nem verificamos duplicidade de email. Vamos tratar disso em breve.</li>
</ul>

<p>Agora, vamos exibir na p√°gina os dados retornados pelo servidor. Adicione o seguinte c√≥digo ao arquivo <code ctc>src/routes/04/login/+page.svelte</code>:</p>
<pre><code>&lt;script&gt;
  let { form } = $props();
&lt;/script&gt;

&lt;h1&gt;Entrada / Registro&lt;/h1&gt;

&lt;form method="POST" action="?/login"&gt;
  &lt;label&gt;Email &lt;input name="email" type="email" value={form?.email || ''} required /&gt;&lt;/label&gt;
  &lt;label&gt;Senha &lt;input name="password" type="password" required /&gt;&lt;/label&gt;
  &lt;button&gt;Entrar&lt;/button&gt;
  &lt;button formaction="?/register"&gt;Registrar&lt;/button&gt;
&lt;/form&gt;

{#if form?.success}
  &lt;div class="d-inline-flex mt-3 alert alert-success alert-dismissible fade show"&gt;
    {form?.msg || 'Sucesso!'}
    &lt;button class="btn-close" data-bs-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;
  &lt;/div&gt;
{/if}</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Linha 2: A propriedade <code>form</code> cont√©m os dados retornados pela a√ß√£o de formul√°rio.</li>
  <li>Linha 14: Se a a√ß√£o retornou <code>success</code>, exibimos a mensagem correspondente.</li>
  <li>Linha 15: As classes <code>alert alert-success alert-dismissible fade show</code> definem o estilo da <a target="_blank" href="https://getbootstrap.com/docs/5.3/components/alerts/#dismissing">caixa de alerta</a> do Bootstrap. <code>d-inline-flex</code> faz com que ela ocupe apenas o espa√ßo necess√°rio.</li>
  <li>Linha 16: Mostra a mensagem retornada ou, se ausente, "Sucesso!".</li>
  <li>Linha 17: Exatamente como est√° na <a target="_blank" href="https://getbootstrap.com/docs/5.3/components/alerts/#dismissing">documenta√ß√£o do Bootstrap</a>.</li>
</ul>

<h2>Valida√ß√£o de erros</h2>
<p>Se a requisi√ß√£o n√£o puder ser processada devido a dados inv√°lidos, √© poss√≠vel retornar mensagens de erro junto com os valores inseridos anteriormente. Isso permite que o usu√°rio corrija os dados e tente novamente. A fun√ß√£o <code>fail</code> retorna um c√≥digo HTTP (geralmente 400 ou 422 em casos de erro de valida√ß√£o) junto com os dados. O c√≥digo de status fica acess√≠vel em <code>page.status</code> e os dados em <code>form</code>.</p>
<p>Implemente a valida√ß√£o de dados na fun√ß√£o <code>register</code> no arquivo <code ctc>src/routes/04/login/+page.server.js</code>:</p>
<pre><code>import { fail } from '@sveltejs/kit';
import * as users from '$lib/server/usersDatabase.js';

export const actions = {
  login: async () =&gt; {
    console.log('Autenticando...');
  },
  register: async ({ request }) =&gt; {
    const data = await request.formData();
    const email = data.get('email');
    const password = data.get('password');

    if (!email || !password) return fail(400, { error: 'Email e senha s√£o obrigat√≥rios.', email });

    if (!email.includes('@')) return fail(400, { error: 'Email inv√°lido.', email });

    if (password.length &lt; 4) return fail(400, { error: 'A senha deve ter pelo menos 4 caracteres.', email });

    if (users.read(email)) return fail(400, { error: 'Email j√° cadastrado.', email });

    try {
      users.create(email, password);
      return { success: true, msg: 'Usu√°rio registrado com sucesso! Agora voc√™ pode fazer o login...' };
    } catch (error) {
      console.error('Erro ao registrar usu√°rio:', error);
      return fail(500, { error: 'Ocorreu um erro inesperado. Tente novamente mais tarde.', email });
    }
  },
};</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Linhas 13‚Äì19: Validamos os dados. Se estiverem inv√°lidos, usamos <code>fail</code> para retornar a mensagem de erro e manter os dados do formul√°rio.</li>
  <li>Linha 15: A valida√ß√£o de email √© simplificada. Em sistemas reais, utilize bibliotecas espec√≠ficas e robustas para isso.</li>
  <li>Linha 19: Impede que um email j√° registrado seja reutilizado.</li>
  <li>Linha 24: Como <code>users.create</code> pode lan√ßar erros, registramos o erro no terminal e exibimos uma mensagem gen√©rica ao usu√°rio.</li>
  <div class="info">Recomenda√ß√£o: N√£o √© boa pr√°tica exibir mensagens de erro t√©cnicas diretamente ao usu√°rio. Elas s√£o √∫teis apenas para desenvolvedores e podem revelar informa√ß√µes sens√≠veis. Por isso, erros de servidor (categoria 500) devem ser registrados apenas no servidor, onde podem ser acessados por quem mant√©m o sistema.</div>
</ul>

<p>Adicione o tratamento de mensagens de erro no arquivo <code ctc>src/routes/04/login/+page.svelte</code>:</p>
<pre><code>&lt;script&gt;
  let { form } = $props();
&lt;/script&gt;

&lt;h1&gt;Entrada / Registro&lt;/h1&gt;

&lt;form method="POST" action="?/login"&gt;
  &lt;label&gt;Email &lt;input name="email" type="email" value={form?.email || ''} required /&gt;&lt;/label&gt;
  &lt;label&gt;Senha &lt;input name="password" type="password" required /&gt;&lt;/label&gt;
  &lt;button&gt;Entrar&lt;/button&gt;
  &lt;button formaction="?/register"&gt;Registrar&lt;/button&gt;
&lt;/form&gt;

{#if form?.error}
  &lt;div class="d-inline-flex mt-3 alert alert-danger alert-dismissible fade show"&gt;
    {form?.error}
    &lt;button class="btn-close" data-bs-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;
  &lt;/div&gt;
{/if}

{#if form?.success}
  &lt;div class="d-inline-flex mt-3 alert alert-success alert-dismissible fade show"&gt;
    {form?.msg || 'Sucesso!'}
    &lt;button class="btn-close" data-bs-dismiss="alert" aria-label="Close"&gt;&lt;/button&gt;
  &lt;/div&gt;
{/if}</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li>Linha 8: O valor do campo email √© mantido em caso de erro, para facilitar a corre√ß√£o por parte do usu√°rio.</li>
  <li>Linha 9: Por seguran√ßa, a senha n√£o √© mantida ap√≥s erro.</li>
  <li>Linhas 14‚Äì19: Se houver erro, mostramos uma caixa de alerta vermelha com a mensagem apropriada.</li>
  <li>A valida√ß√£o no navegador (como <code>type="email"</code> e <code>required</code>) ajuda a evitar erros, mas a valida√ß√£o no servidor √© indispens√°vel, pois o c√≥digo do cliente pode ser alterado pelo usu√°rio. Para testar, inspecione o campo de e-mail, remova o atributo <code>type="email"</code> e tente enviar um endere√ßo de e-mail inv√°lido.</li>
  <li>Agora √© a hora, teste o easter egg!</li>
</ul>

<h2>Redirecionamentos</h2>
<p>Redirecionamentos (assim como erros) funcionam da mesma forma que em <a target="_blank" href="https://svelte.dev/docs/kit/load#Redirects"><code>load</code></a>. Por exemplo, ap√≥s o registro de um novo usu√°rio, exigimos que ele fa√ßa login. E, ap√≥s o login, podemos redirecion√°-lo automaticamente para uma p√°gina de usu√°rio.</p>

<p>Agora, implemente a l√≥gica de login no arquivo <code ctc>src/routes/04/login/+page.server.js</code>:</p>

<pre><code>import { fail, redirect } from '@sveltejs/kit';
import * as users from '$lib/server/usersDatabase.js';

export const actions = {
  login: async ({ request }) =&gt; {
    const data = await request.formData();
    const email = data.get('email');
    const password = data.get('password');

    if (!email || !password) return fail(400, { error: 'Email e senha s√£o obrigat√≥rios.', email });

    const user = users.read(email);

    if (!user) return fail(400, { error: 'Usu√°rio n√£o encontrado.', email });

    if (user.password != password) return fail(400, { error: 'Senha incorreta.', email });

    redirect(303, '/04/dashboard');
  },
  // continua conforme estava...
</code></pre>

<p>Explica√ß√£o:</p>
<ul>
  <li><strong>Linha 1:</strong> Importamos a fun√ß√£o <code>redirect</code>, necess√°ria para realizar o redirecionamento.</li>
  <li><strong>Linhas 6‚Äì8:</strong> Coletamos os dados do formul√°rio enviado.</li>
  <li><strong>Linhas 10, 14 e 16:</strong> Realizamos valida√ß√µes nos dados.</li>
  <li><strong>Linha 12:</strong> Buscamos o usu√°rio no "banco de dados".</li>
  <li id="dashboard"><strong>Linha 18:</strong> Se o login for bem-sucedido, redirecionamos o usu√°rio para <code>/04/dashboard</code> com o c√≥digo HTTP 303. Essa p√°gina ainda n√£o foi criada ‚Äî fica como tarefa para voc√™ implement√°-la.</li>
</ul>

<div class="info">Toda resposta a uma requisi√ß√£o HTTP possui um c√≥digo de status. C√≥digos na faixa dos 400 indicam erros do cliente, os da faixa dos 500 indicam erros do servidor, e os da faixa dos 300 representam redirecionamentos. Saiba mais na <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status">documenta√ß√£o do MDN</a>.</div>

<h2>GET vs POST</h2>
<p>Como vimos, para invocar uma <em>a√ß√£o de formul√°rio</em>, √© necess√°rio usar <code>method="POST"</code>. No entanto, nem todo formul√°rio precisa enviar dados ao servidor via POST ‚Äî em formul√°rios de busca, por exemplo, √© comum utilizar <code>method="GET"</code> (ou simplesmente omitir o atributo <code>method</code>). Nesses casos, o SvelteKit trata o formul√°rio como um link:</p>

<pre><code>&lt;form action="/search"&gt; &lt;label&gt; Search &lt;input name="q"&gt; &lt;/label&gt; &lt;/form&gt;</code></pre>

<p>Ao submeter esse formul√°rio, o navegador navegar√° para <code>/search?q=...</code>, invocando a fun√ß√£o <code>load</code>, mas sem invocar uma <code>action</code>.</p>

<h2>Conclus√£o</h2>
<p>Esta foi uma introdu√ß√£o √† l√≥gica de autentica√ß√£o com formul√°rios e redirecionamentos no SvelteKit. Ainda h√° muitos aspectos importantes que n√£o abordamos ‚Äî como o uso de cookies, armazenamento de sess√µes, prote√ß√£o de rotas e logout seguro. Esses t√≥picos ser√£o tratados em li√ß√µes futuras. Por enquanto, concentre-se em entender bem a comunica√ß√£o entre cliente e servidor.</p>

<h2>Exerc√≠cios</h2>
<ol class="excs">
  <li>Crie a p√°gina <a href="#dashboard"><code>/04/dashboard</code></a> e exiba nela uma mensagem personalizada, como: <code>‚ÄúBem-vindo(a), [email]!‚Äù</code>, utilizando o email do usu√°rio autenticado.</li>
  <li>
    <strong>Formul√°rio de cadastro com valida√ß√£o no servidor</strong>
    <p>Crie um formul√°rio com os seguintes campos obrigat√≥rios:</p>
    <ul>
      <li><code>nome</code>: M√≠nimo de 2 caracteres.</li>
      <li><code>email</code>: Deve conter apenas letras, <code>@</code> e <code>.</code>, com pelo menos uma palavra antes do <code>@</code> e duas ap√≥s, separadas pelo <code>.</code>.</li>
      <li><code>data de nascimento</code>: A idade deve ser ‚â• 12 anos.</li>
    </ul>
    <p>Se houver erros:</p>
    <ul>
      <li>Use <code>fail</code> para retornar os dados preenchidos e mensagens de erro.</li>
      <li>Exiba os erros abaixo de cada campo no formul√°rio.</li>
    </ul>
    <p>Se estiver tudo certo:</p>
    <ul>
      <li>Retorne <code>{ success: true, nome }</code> e exiba:
        <blockquote>
          <p>‚ÄúCadastro conclu√≠do com sucesso. Bem-vindo(a), [nome]!‚Äù</p>
        </blockquote>
      </li>
    </ul>
  </li>
  <li><strong>Formul√°rio de pagamento com redirecionamento para o plano contratado</strong>
    <p>Crie um formul√°rio com os seguintes campos obrigat√≥rios:</p>
    <ul>
      <li><code>nome no cart√£o</code>: M√≠nimo 3 letras.</li>
      <li><code>n√∫mero do cart√£o</code>: 16 d√≠gitos.</li>
      <li><code>data de validade</code>: formato MM/AA, data futura.</li>
      <li><code>c√≥digo de seguran√ßa (CVV)</code>: 3 d√≠gitos.</li>
      <li><code>plano</code>: Campo select com as op√ß√µes: <code>Plano Bit (b√°sico)</code>, <code>Plano Byte (intermedi√°rio)</code>, <code>Plano Quantum (premium)</code>.</li>
    </ul>
    <p>Se houver erros:</p>
    <ul>
      <li>Use <code>fail</code> para retornar os dados preenchidos e erros.</li>
      <li>Exiba os erros abaixo de cada campo no formul√°rio.</li>
    </ul>
    <p>Se estiver tudo certo, redirecione para a p√°gina com base no plano:</p>
    <ul>
      <li><code>/04/ex2/basico</code></li>
      <li><code>/04/ex2/intermediario</code></li>
      <li><code>/04/ex2/premium</code></li>
    </ul>
    <p>Essas p√°ginas devem mostrar informa√ß√µes (inventadas) sobre o plano, bem como:</p>
    <blockquote>
      <p>‚ÄúPagamento aprovado. Bem-vindo(a) ao Plano [X]!‚Äù</p>
    </blockquote>
  </li>
  <li><strong>CRUD completo de produtos</strong>
    <p>Crie as seguintes rotas:</p>
    <ul>
      <li>
        <strong><code>/04/ex3/produtos/novo</code></strong> (Formul√°rio de Cria√ß√£o)
        <ul>
          <li>Formul√°rio com os campos: nome (obrigat√≥rio, exclusivo), descri√ß√£o (opcional, min. 10 caracteres), pre√ßo (positivo), quantidade (inteiro ‚â• 0)</li>
          <li>Falha: retorna dados e erros.</li>
          <li>Sucesso: redireciona para a Lista de Produtos com uma mensagem de sucesso.</li>
        </ul>
      </li>
      <li>
        <strong><code>/04/ex3/produtos/[id]/editar</code></strong> (Formul√°rio de Edi√ß√£o)
        <ul>
          <li>Carrega os dados do produto via <code>load</code>.</li>
          <li>Mesma valida√ß√£o da cria√ß√£o.</li>
          <li>Falha: retorna dados e erros.</li>
          <li>Sucesso: redireciona para a Lista de Produtos com uma mensagem de sucesso.</li>
        </ul>
      </li>
      <li>
        <strong><code>/04/ex3/produtos</code></strong> (Lista de Produtos)
        <ul>
          <li>Link para o Formul√°rio de Cria√ß√£o.</li>
          <li>Tabela com nome, descri√ß√£o, pre√ßo e quantidade dos produtos.</li>
          <li>Cada item tem um link para o Formul√°rio de Edi√ß√£o do produto.</li>
          <li>Cada item tamb√©m tem um formul√°rio de exclus√£o do produto que executa a a√ß√£o nomeada <code>excluir</code> na mesma rota. Ao excluir, retorna uma mensagem de sucesso.</li>
          <li>Exibe mensagens de sucesso ap√≥s a√ß√µes como cria√ß√£o, edi√ß√£o ou exclus√£o.</li>
        </ul>
      </li>
    </ul>
    <p>Dicas:</p>
    <ul>
      <li>Os dados podem ser armazenados em um array ou mapa local em <code>$lib/server/produtos.js</code> com fun√ß√µes <code>create</code>, <code>read</code>, <code>update</code> e <code>delete</code>, simulando um banco de dados.</li>
      <li>Para simplifica√ß√£o, use um contador incremental para IDs.</li>
      <li>As mensagens de sucesso nos redirecionamentos podem ser passadas via par√¢metros de consulta e obtidas com <code>URLSearchParams</code>.</li>
    </ul>
  </li>
  <li><strong>N√£o se esque√ßa de estilizar as p√°ginas!</strong></li>
</ol>