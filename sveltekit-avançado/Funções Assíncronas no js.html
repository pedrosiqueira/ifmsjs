<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/highlightjs-svelte/dist/svelte.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
  <script defer>hljs.configure({ languages: ["svelte"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

  <!-- https://github.com/arronhunt/highlightjs-copy -->
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

  <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
  <!-- <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
  <script defer>hljs.highlightLinesAll([
      // [{ start: 2, end: 2, color: 'lightgreen' }, { start: 9, end: 9, color: 'lightblue' }, { start: 14, end: 14, color: 'lightblue' }]
    ]);
  </script> -->

  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body,{delimiters:[{left: '$$', right: '$$', display: true},{left: '$', right: '$', display: false}]});"></script> -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
  <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h2 id="fun-es-ass-ncronas-no-javascript">Fun√ß√µes Ass√≠ncronas no JavaScript</h2>
<h3 id="fun-es-s-ncronas-vs-ass-ncronas">Fun√ß√µes s√≠ncronas vs ass√≠ncronas</h3>
<p>üëâ <strong>Pergunta:</strong> Qual o conceito de s√≠ncrono e de ass√≠ncrono?</p>
<p>No JavaScript, c√≥digo normalmente executa de forma s√≠ncrona, linha por linha. Mas algumas opera√ß√µes, como buscar dados na internet, podem demorar. Se esper√°ssemos o resultado antes de seguir para a pr√≥xima linha, o c√≥digo ficaria travado.</p>
<p>Exemplo de c√≥digo s√≠ncrono:</p>
<pre><code class="js">console.log("Primeiro");
console.log("Segundo");
console.log("Terceiro");</code></pre>
<h3 id="a-fun-o-ass-ncrona-settimeout-">A fun√ß√£o ass√≠ncrona <code>setTimeout</code></h3>
<p><code>setTimeout</code> √© um exemplo cl√°ssico de fun√ß√£o ass√≠ncrona. Ela agenda uma fun√ß√£o para rodar depois de um tempo.</p>
<p>C√≥digo exemplo:</p>
<pre><code class="js">console.log("Antes de setTimeout");

setTimeout(() => {
  console.log("Dentro de setTimeout");
}, 2000);

console.log("Depois de setTimeout");</code></pre>
<p>üìå <strong>Pergunta:</strong> Qual ser√° a ordem de execu√ß√£o?</p>
<p>O <code>setTimeout</code> agenda a execu√ß√£o do c√≥digo para o futuro, mas n√£o bloqueia o restante do programa.</p>
<h3 id="introdu-o-s-promise-s">Introdu√ß√£o √†s <code>Promise</code>s</h3>
<p>Uma <code>Promise</code> √© um objeto que representa um valor que estar√° dispon√≠vel no futuro. Pode estar em tr√™s estados:</p>
<ul>
  <li><strong>Pending</strong> (pendente)</li>
  <li><strong>Fulfilled</strong> (resolvida)</li>
  <li><strong>Rejected</strong> (rejeitada)</li>
</ul>
<p>Antes das <code>Promise</code>s, a abordagem mais comum para lidar com opera√ß√µes ass√≠ncronas (como requisi√ß√µes HTTP, leitura de arquivos ou intera√ß√µes com bancos de dados) era usar fun√ß√µes <strong>callback</strong>. No entanto, essa abordagem apresentava diversos problemas, como o famoso <strong>Callback hell</strong>: Quando uma fun√ß√£o callback tamb√©m chama outra fun√ß√£o callback, criando uma cadeia de fun√ß√µes aninhadas (uma dentro da outra).</p>
<p>Exemplo de "callback hell":</p>
<pre><code class="js">buscarDados((dados) => {
  processarDados(dados, (resultado) => {
    salvarNoBanco(resultado, (res) => {
      console.log("Dados salvos!");
    });
  });
});</code></pre>
<p>Observa√ß√£o: Callbacks s√£o fun√ß√µes passadas como argumento para outras fun√ß√µes e executadas posteriormente, geralmente ap√≥s a conclus√£o de uma opera√ß√£o ass√≠ncrona.</p>
<p><code>Promise</code>s surgiram no JavaScript para resolver problemas relacionados ao c√≥digo ass√≠ncrono, como o Callback hell:</p>
<pre><code class="js">buscarDados()
  .then(processarDados)
  .then(salvarNoBanco)
  .then(() => console.log("Dados salvos!"))
  .catch((erro) => console.error("Erro:", erro));</code></pre>
<p>Com <code>Promise</code>s, a cadeia de fun√ß√µes n√£o fica mais aninhada, mas sim serializada, o que simplifica o desenvolvimento e melhora a legibilidade.</p>
<p>Exemplo de uma <code>Promise</code> simples:</p>
<pre><code class="js">const promessa = new Promise((resolve, reject) => {
    let senha = prompt('Senha?');
    if (senha === '1234') resolve('O segredo √© "42"!');
    else reject('N√£o te conto o segredo!');
});

promessa
    .then((resultado) => {
        console.log("Acesso liberado...")
        console.log(resultado);
    })
    .catch((erro) => {
        console.log("Acesso proibido...")
        console.error(erro);
    });</code></pre>
<p>üì¢ <strong>Explica√ß√£o:</strong></p>
<ul>
  <li>O c√≥digo entre as chaves de um objeto <code>Promise</code> √© executado.</li>
  <li>Se a promessa for cumprida, ent√£o <code>resolve</code> deve ser executado, passando um valor para o <code>then</code>.</li>
  <li>Se a promessa n√£o puder ser cumprida, ent√£o <code>reject</code> deve ser executado, passando um valor para o <code>catch</code>.</li>
  <li>O <code>then</code> √© executado quando a promessa √© cumprida (resolvida), recebendo o valor passado no <code>resolve</code>.</li>
  <li>O <code>catch</code> √© executado quando a promessa √© rejeitada (n√£o cumprida), recebendo o valor passado no <code>reject</code>.</li>
</ul>
<hr>
<h3 id="a-fun-o-ass-ncrona-fetch-">A fun√ß√£o ass√≠ncrona <code>fetch</code></h3>
<p>A fun√ß√£o <code>fetch</code> √© usada para fazer requisi√ß√µes HTTP a um servidor, e retorna uma <code>Promise</code>. Para testar o <code>fetch</code>, vamos requisitar objetos fict√≠cios do servidor <a href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com/</a>.</p>
<p>C√≥digo exemplo:</p>
<pre><code class="js">function iniciar() {
    function requisicaoAssincrona() {
        fetch('https://jsonplaceholder.typicode.com/todos/1')
            .then((resposta) => resposta.json())
            .then((dados) => console.log(dados))
            .catch((erro) => console.error('Erro!', erro));
    }

    console.log('antes da requisi√ß√£o');
    requisicaoAssincrona();
    console.log('depois da requisi√ß√£o');
}
iniciar();</code></pre>

<p>üìå <strong>Explica√ß√£o:</strong></p>
<ul>
  <li><code>fetch(url)</code> faz a requisi√ß√£o a um objeto &quot;tarefa.</li>
  <li>O primeiro <code>then</code> obt√©m a resposta da requisi√ß√£o.</li>
  <li><code>resposta.json()</code> extrai o objeto da resposta.</li>
  <li>O segundo <code>then</code> obt√©m o objeto ap√≥s a extra√ß√£o.</li>
  <li>O <code>catch</code> captura poss√≠veis erros.</li>
</ul>
<h3 id="transformando-c-digo-ass-ncrono-em-s-ncrono-com-async-await-">Transformando c√≥digo ass√≠ncrono em s√≠ncrono com <code>async/await</code></h3>
<p>O <code>async/await</code> simplifica o uso de <code>Promise</code>s. Ele permite que <strong>c√≥digo ass√≠ncrono seja executado de modo s√≠ncrono</strong>.</p>
<p>C√≥digo exemplo:</p>
<pre><code class="js">async function iniciar() {
    async function requisicaoSincrona() {
        try {
            let resposta = await fetch('https://jsonplaceholder.typicode.com/todos/1');
            let dados = await resposta.json();
            console.log(dados);
        } catch (erro) {
            console.error('Erro!', erro);
        }
    }

    console.log('antes da requisi√ß√£o');
    await requisicaoSincrona();
    console.log('depois da requisi√ß√£o');
}
iniciar();</code></pre>

<p>üìå <strong>Explica√ß√£o:</strong></p>
<ul>
  <li>Toda fun√ß√£o que usa <code>await</code> deve ser declarada com <code>async</code>.</li>
  <li><code>await</code> pausa a execu√ß√£o at√© que a <code>Promise</code> seja resolvida.</li>
  <li><code>try/catch</code> ajuda a capturar poss√≠veis erros.</li>
</ul>
<p>O que acontece se voc√™ tirar o <code>await</code> de <code>await requisicaoSincrona();</code>?</p>
<p>O <code>async/await</code> tamb√©m permite que <strong>c√≥digo s√≠ncrono seja executado de modo ass√≠ncrono</strong>:</p>
<pre><code class="js">    async function iniciar() {
        function freezeForSeconds(seconds) {
            return new Promise((resolve) => setTimeout(resolve, seconds * 1000));
        }

        console.log('Start freezing...');
        await freezeForSeconds(3);
        console.log('End freezing after 3 seconds');
    }
    iniciar();</code></pre>
<p>üì¢ <strong>Explica√ß√£o:</strong></p>
<ul>
  <li>O <code>setTimeout</code> √© ass√≠ncrono por natureza, mas se o colocarmos dentro de uma promessa, podemos usar o recurso <code>async/await</code> para esperar pela promessa ser cumprida.</li>
  <li>Ap√≥s o tempo especificado <code>seconds * 1000</code>, o comando <code>resolve</code> ser√° executado, indicando que a promessa foi cumprida (resolvida).</li>
</ul>

<h3 id="recapitulando">Recapitulando</h3>
<ul>
  <li><code>setTimeout</code> agenda fun√ß√µes sem travar o c√≥digo.</li>
  <li><code>Promise</code>s ajudam a trabalhar com valores futuros.</li>
  <li><code>fetch</code> faz requisi√ß√µes HTTP e retorna uma <code>Promise</code>.</li>
  <li><code>async/await</code> facilita o trabalho com c√≥digo ass√≠ncrono.</li>
</ul>
<hr>
<h3 id="exerc-cios">Exerc√≠cios</h3>
<ol class="excs">
  <li>Crie uma p√°gina de contagem regressiva de 10 segundos.
    <ol>
      <li>Melhore a p√°gina de modo que o usu√°rio possa colocar a quantidade de segundos.</li>
    </ol>

  </li>
  <li>Crie as seguintes fun√ß√µes que fa√ßam requisi√ß√µes ao servi√ßo <a href="https://jsonplaceholder.typicode.com/users">https://jsonplaceholder.typicode.com/users</a>:
    <ol>
      <li>Buscar usu√°rios e exibir apenas os nomes.</li>
      <li>Buscar uma postagem com um id espec√≠fico e exibir apenas o t√≠tulo.</li>
      <li>Buscar um usu√°rio por id, e exibir o t√≠tulo de suas postagens.</li>
      <li>Buscar usu√°rios por email, e exibir o t√≠tulo de suas postagens.</li>
      <li>Buscar uma postagem, e exibir seu t√≠tulo, conte√∫do e seus coment√°rios.</li>
      <li>Buscar usu√°rios por cidade.</li>
    </ol>
  </li>
</ol>