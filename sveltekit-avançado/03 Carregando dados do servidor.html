<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://unpkg.com/highlightjs-svelte/dist/svelte.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
  <script defer>hljs.configure({ languages: ["svelte"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

  <!-- https://github.com/arronhunt/highlightjs-copy -->
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

  <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
  <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
  <script defer>hljs.highlightLinesAll([[], [], [], [], [], [], [{ start: 1, end: 1, color: 'lightgreen' }, { start: 2, end: 2, color: 'lightblue' }], [], [], [], [], [], [], [], [], [], [], [], [{ start: 2, end: 2, color: 'lightblue' }, { start: 5, end: 5, color: 'lightblue' }, { start: 8, end: 10, color: 'lightblue' }]]);
  </script>

  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body,{delimiters:[{left: '$$', right: '$$', display: true},{left: '$', right: '$', display: false}]});"></script> -->

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
  <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h1 id="carregando-dados-no-sveltekit">Carregando Dados do Servidor</h1>
<sub><a target="_blank" href="https://svelte.dev/docs/kit/load">Adaptado daqui</a>.</sub>
<p>Antes que um componente <code>+page.svelte</code> (e seus componentes <code>+layout.svelte</code> correspondentes) possa ser renderizado, frequentemente precisamos obter alguns dados. Isso √© feito definindo fun√ß√µes <code>load</code>.</p>

<h2 id="dados-da-p√°gina">Dados da P√°gina</h2>

<p>Um arquivo <code>+page.svelte</code> pode ter um arquivo irm√£o <code>+page.server.js</code>, que ser√° executado no servidor antes de abrir a p√°gina no cliente. Esse arquivo exporta uma fun√ß√£o <code>load</code>. O valor retornado por essa fun√ß√£o estar√° dispon√≠vel para a p√°gina atrav√©s da propriedade <code>data</code>.</p>
<p>Crie o arquivo <code ctc>src/routes/03/test/+page.server.js</code>:</p>
<pre><code class="language-javascript">export function load() {
  return {
    post: { title: 'T√≠tulo de Exemplo', content: 'Conte√∫do &lt;b&gt;supimpa&lt;/b&gt; de Exemplo' },
    author: { name: 'Autor Exemplo', email: 'autor@exemplo.com' }
  };
}</code></pre>
<p>Crie o arquivo <code ctc>src/routes/03/test/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h1&gt;{data.post.title}&lt;/h1&gt;
&lt;sub&gt;por {data.author.name}&lt;/sub&gt;
&lt;div&gt;{@html data.post.content}&lt;/div&gt;</code></pre>
<p id="load-return"><strong>Explica√ß√£o:</strong> A fun√ß√£o <code>load</code> em <code>+page.server.js</code> retorna um objeto com os dados necess√°rios para a p√°gina. Esses dados s√£o acessados no componente Svelte atrav√©s da propriedade <code>data</code>.</p>

<h2 id="dados-do-layout">Dados do Layout</h2>

<p>Teus arquivos <code>+layout.svelte</code> tamb√©m podem carregar dados, via <code>+layout.server.js</code>.</p>
<p>Crie o arquivo <code ctc>src/lib/server/postsDatabase.js</code>:</p>
<pre id="postsdatabase"><code class="language-javascript">const posts = [
  { slug: 'um', title: 'Primeiro Post', publish_date: '2025-03-12', content: 'Conte√∫do do primeiro post' },
  { slug: 'outro', title: 'Outro Post', publish_date: '2025-03-25', content: 'Conte√∫do do outro post' },
  { slug: 'algum', title: 'Mais um Post', publish_date: '2024-11-22', content: 'Conte√∫do de mais um post' },
  { slug: 'ainda', title: 'Ainda Outro Post', publish_date: '2024-11-02', content: 'Conte√∫do de ainda outro post' }
];

export function getAll(){ }
export function getByYearMonth(year, month){ }
export function getBySlug(slug){ }
export function getByQuery(title, content){ }</code></pre>
<p><strong>Explica√ß√£o</strong>: Este arquivo simula um banco de dados de posts. Ele armazena um conjunto de dados em mem√≥ria e define fun√ß√µes para acessar esses dados. No momento, as fun√ß√µes est√£o declaradas mas ainda n√£o foram implementadas ‚Äî essa ser√° a tua tarefa.</p>
<div class="info">Aten√ß√£o: Esse √© um banco de dados apenas para fins did√°ticos! No mundo real, nossos dados ficariam em um banco de dados de verdade.</div>
<p>Crie o arquivo <code ctc>src/routes/03/posts/+layout.server.js</code>:</p>
<pre><code class="language-javascript">import * as postsDatabase from '$lib/server/postsDatabase';

export async function load() {
  const posts = postsDatabase.getAll();
  return { posts };
}</code></pre>
<p>A fun√ß√£o <code>getAll()</code> ainda n√£o existe no arquivo <code>src/lib/server/postsDatabase.js</code>. Ser√° tua tarefa implement√°-la, bem como todas as outras fun√ß√µes ainda n√£o implementadas.</p>
<p>Crie o arquivo <code ctc>src/routes/03/posts/+layout.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data, children } = $props();
&lt;/script&gt;

&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col-4 bg-body-secondary&quot;&gt;
    &lt;aside&gt;
      &lt;h4&gt;√öltimos Posts&lt;/h4&gt;
      &lt;ul&gt;
        {#each data.posts.slice(0, 2) as post}
          &lt;li&gt;
            &lt;a href=&quot;/03/posts/{post.slug}&quot;&gt;
              {post.title}
            &lt;/a&gt;
          &lt;/li&gt;
        {/each}
      &lt;/ul&gt;
    &lt;/aside&gt;
  &lt;/div&gt;
  &lt;div class=&quot;col&quot;&gt;
    &lt;main&gt;
      {@render children()}
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p><strong>Explica√ß√£o:</strong> Dados retornados pela fun√ß√£o <code>load</code> de um arquivo <code>+layout.server.js</code> ficam dispon√≠veis para todos os seus componentes <code>.svelte</code> filhos, bem como para ele pr√≥prio. Aqui, o arquivo <code>+layout.server.js</code> carrega todos os posts e os disponibiliza para o layout e suas p√°ginas filhas. No layout, exibimos os dois posts mais recentes em um menu lateral.</p>
<p>Vamos criar uma p√°gina filha. Crie o arquivo <code ctc>src/routes/03/posts/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h3&gt;Todos os Posts&lt;/h3&gt;
{#each data.posts as post}
  &lt;p&gt;&lt;a href=&quot;/03/posts/{post.slug}&quot;&gt;{post.title}&lt;/a&gt;&lt;/p&gt;
{/each}</code></pre>
<p><strong>Explica√ß√£o:</strong> A p√°gina principal lista todos os posts dispon√≠veis, utilizando os dados fornecidos pelo layout.</p>
<div class="info">
  <p><strong>Nota:</strong> Se m√∫ltiplas fun√ß√µes <code>load</code> retornarem dados com a mesma propriedade, a √∫ltima sobrescreve as anteriores. Por exemplo, se uma fun√ß√£o <code>load</code> do layout retorna <code>{ a: 1, b: 2 }</code> e a da p√°gina retorna <code>{ b: 3, c: 4 }</code>, o resultado final ser√° <code>{ a: 1, b: 3, c: 4 }</code>.</p>
</div>

<h2 id="load-params">Par√¢metros da Fun√ß√£o <code>load</code></h2>
<p>A fun√ß√£o <code>load</code> recebe um objeto do tipo <a target="_blank" href="https://svelte.dev/docs/kit/@sveltejs-kit#ServerLoadEvent" id="serverloadevent">ServerLoadEvent</a> como argumento. Esse objeto cont√©m v√°rias propriedades √∫teis, como <code>params</code>, <code>url</code>, <code>fetch</code>, entre outras.</p>
<p>Para verificar o conte√∫do desse objeto, altere o arquivo <code>src/routes/03/test/+page.server.js</code>:</p>
<pre><code>export function load(event) {
  console.log(event);
  return {
    post: {
      title: 'T√≠tulo de Exemplo',
      content: 'Conte√∫do <b>supimpa</b> de Exemplo'
    },
    author: {
      name: 'Autor Exemplo',
      email: 'autor@exemplo.com'
    }
  };
}</code></pre>
<p><strong>Explica√ß√£o:</strong></p>
<p>Neste exemplo, estamos exibindo no terminal do servidor todas as propriedades do objeto <code>event</code>, que representa a requisi√ß√£o feita para essa p√°gina. Ao acessar a URL correspondente, observe o terminal para verificar as informa√ß√µes registradas.</p>
<div class="info">
  <h4>Anatomia de uma URL</h4>
  <pre>    https://meusite.com/uma/pagina?p1=123&p2=oi
    11111   22222222222 3333333333 444444444444
protocolo   dom√≠nio     par√¢metros par√¢metros  
                        de rota    de consulta
  </pre>
  <p>Os par√¢metros de rota (route params) tamb√©m podem ser chamados de par√¢metros de caminho (path params).</p>
  <p>Os par√¢metros de consulta (query params) tamb√©m podem ser chamados de par√¢metros de busca (search params).</p>
  <p>Exemplo de uma URL real:</p>
  <p class="text-center"><a target="_blank" href="https://www.youtube.com/watch?v=TiT7TlAWDEs&list=PLcZDQl73nB1ACZdEAd_wNbY0tB_QutcH3&index=2&t=60s&ab_channel=PedroHenriquedeAraujoSiqueira">
      <pre>https://
www.youtube.com
/watch
?v=TiT7TlAWDEs
&list=PLcZDQl73nB1ACZdEAd_wNbY0tB_QutcH3
&index=2
&t=360s
&ab_channel=PedroHenriquedeAraujoSiqueira</pre>
    </a></p>
</div>
<h3 id="params">params</h3>

<p>Uma rota pode ser um caminho est√°tico, como <code>src/routes/about</code>, ou um caminho din√¢mico, como <code>src/routes/blog/[slug]</code> ou <code>src/routes/posts/[ano]/[mes]</code>. Neste caso, <code>[slug]</code>, <code>[ano]</code> e <code>[mes]</code> s√£o chamados de <strong>par√¢metros de rota</strong>, ou seja, vari√°veis que permitem diferentes valores levarem √† mesma p√°gina.</p>
<p>Por exemplo:</p>
<ul>
  <li>A URL <code>/about</code> abrir√° a p√°gina em <code>src/routes/about</code>.</li>
  <li>As URLs <code>/blog/post1</code> e <code>/blog/post2</code> abrir√£o a mesma p√°gina din√¢mica em <code>src/routes/blog/[slug]</code>, sendo que o valor de <code>slug</code> ser√° <code>post1</code> ou <code>post2</code>, respectivamente.</li>
  <li>Da mesma forma, <code>/posts/2025/03</code> e <code>/posts/2024/11</code> abrir√£o a p√°gina <code>src/routes/posts/[ano]/[mes]</code>, com <code>ano</code> sendo <code>2025</code> ou <code>2024</code>, e <code>mes</code> sendo <code>03</code> ou <code>11</code>.</li>
</ul>
<ol class="excs">
  <h4>Exerc√≠cios de fixa√ß√£o</h4>
  <li>Ligue as URLs da esquerda √†s rotas da direita:
    <pre>https://meusite.com/blog              (a)
https://meusite.com/sobre             (b)
https://meusite.com/blog/[slug]       (c)
https://meusite.com/blog/artigo       (d)           (1) src/routes/about
https://meusite.com/slug              (e)           (2) src/routes/blog
https://meusite.com/blog/2025/03      (f)           (3) src/routes/blog/[slug]
https://meusite.com/2025/03           (g)           (4) src/routes/blog/[ano]/[mes]
https://meusite.com/blog/2025         (h)           (5) "erro 404"
https://meusite.com/blog/outro/artigo (i)
https://meusite.com/blog/about        (j)
https://meusite.com/blog/2025/03/01   (k)</pre>
  </li>
</ol>
<p>A propriedade <code>params</code> √© um <strong>objeto</strong> onde cada propriedade corresponde ao nome do par√¢metro definido entre colchetes na rota, e seu valor corresponde ao trecho da URL acessada.</p>
<p>Crie o arquivo <code ctc>src/routes/03/posts/[ano]/[mes]/+page.server.js</code>:</p>
<pre><code class="language-javascript">import * as postsDatabase from '$lib/server/postsDatabase';

export async function load({ params }) {
  const posts = postsDatabase.getByYearMonth(params.ano, params.mes);
  return { posts, ano: params.ano, mes: params.mes };
}</code></pre>
<p>Crie o arquivo <code ctc>src/routes/03/posts/[ano]/[mes]/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h3&gt;Postagens de {data.mes}/{data.ano}&lt;/h3&gt;

{#each data.posts as post}
  &lt;p&gt;&lt;a href=&quot;/03/posts/{post.slug}&quot;&gt;{post.title}&lt;/a&gt;&lt;/p&gt;
{:else}
  &lt;p&gt;Nenhuma postagem nesse m&ecirc;s!&lt;/p&gt;
{/each}</code></pre>
<p><strong>Explica√ß√£o:</strong> Utilizamos os par√¢metros de rota <code>ano</code> e <code>mes</code> para filtrar os posts por data.</p>
<p>Tamb√©m podemos implementar uma √∫nica p√°gina para exibir cada post separadamente.</p>
<p>Crie o arquivo <code ctc>src/routes/03/posts/[slug]/+page.server.js</code>:</p>
<pre><code class="language-javascript">import * as postsDatabase from '$lib/server/postsDatabase';

export async function load({ params }) {
  const post = postsDatabase.getBySlug(params.slug);
  return { post };
}</code></pre>
<p>Crie o arquivo <code ctc>src/routes/03/posts/[slug]/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h1&gt;{data.post.title}&lt;/h1&gt;
&lt;sub&gt;Em {data.post.publish_date}&lt;/sub&gt;
&lt;p&gt;{data.post.content}&lt;/p&gt;</code></pre>
<p><strong>Explica√ß√£o:</strong> Aqui, utilizamos o par√¢metro de rota <code>slug</code> para buscar e exibir um post espec√≠fico.</p>

<h3 id="url">url</h3>

<p>Al√©m dos <strong>par√¢metros de rota</strong>, tamb√©m podemos passar informa√ß√µes pela <strong>URL</strong> usando o que chamamos de <strong>par√¢metros de consulta</strong> ‚Äî tamb√©m conhecidos como <strong>query params</strong> ou <strong>search params</strong>.</p>
<p>Esses par√¢metros aparecem ap√≥s o s√≠mbolo <code>?</code> na URL. Por exemplo:</p>
<pre><code>https://meusite.com/produtos?categoria=livros&amp;ordem=preco</code></pre>
<p>Nesse caso, a URL possui dois query params:</p>
<ul>
  <li><code>categoria</code> com valor <code>&quot;livros&quot;</code></li>
  <li><code>ordem</code> com valor <code>&quot;preco&quot;</code></li>
</ul>
<p>No SvelteKit, dentro da fun√ß√£o <code>load</code>, voc√™ pode acessar esses dados atrav√©s da propriedade <code>url</code>, que √© um objeto do tipo <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/URL">URL</a>. Esse objeto representa a URL da requisi√ß√£o e cont√©m v√°rias informa√ß√µes √∫teis, como:</p>
<ul>
  <li><code>origin</code>: origem da URL (ex: <code>https://meusite.com</code>)</li>
  <li><code>pathname</code>: caminho da URL (ex: <code>/produtos</code>)</li>
  <li><code>searchParams</code>: um objeto do tipo <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams">URLSearchParams</a>, que representa os par√¢metros de consulta da URL e permite acessar facilmente os valores dos query params.</li>
</ul>
<p>Crie o arquivo <code ctc>src/routes/03/posts/query/+page.server.js</code>:</p>
<pre><code class="language-javascript">import * as postsDatabase from '$lib/server/postsDatabase';

export async function load({ url }) {
  console.log(url);
  const title = url.searchParams.get('title') || null;
  const content = url.searchParams.get('content') || null;

  if (!title && !content) return { posts: postsDatabase.getAll() };

  return { posts: postsDatabase.getByQuery(title, content) };
}</code></pre>
<div class="info">
  <p>üí° <strong>Dica:</strong> Neste exemplo, usamos <code>console.log()</code> para exibir o conte√∫do da URL e dos par√¢metros no terminal ou no console do navegador. Essa √© uma ferramenta muito √∫til para <strong>debugar</strong> (ou seja, investigar e entender o que est√° acontecendo no seu c√≥digo).</p>
  <p>Sempre que estiver em d√∫vida sobre o que uma vari√°vel cont√©m, experimente usar <code>console.log(minhaVariavel)</code> para visualizar seu valor. Isso pode ajudar bastante na hora de identificar problemas e entender melhor o fluxo do programa.</p>
</div>
<p>Crie o arquivo <code ctc>src/routes/03/posts/query/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;form&gt;
  &lt;input type=&quot;text&quot; name=&quot;title&quot; placeholder=&quot;Busca por t√≠tulo...&quot; /&gt;
  &lt;input type=&quot;text&quot; name=&quot;content&quot; placeholder=&quot;Busca por conte√∫do...&quot; /&gt;
  &lt;button type=&quot;submit&quot;&gt;Buscar&lt;/button&gt;
&lt;/form&gt;

&lt;h1&gt;Busca de posts&lt;/h1&gt;

&lt;ul&gt;
  {#each data.posts as post}
    &lt;li&gt;&lt;a href=&quot;/03/posts/{post.slug}&quot;&gt;{post.title}&lt;/a&gt;&lt;/li&gt;
  {:else}
    &lt;li&gt;Nenhum resultado encontrado.&lt;/li&gt;
  {/each}
&lt;/ul&gt;</code></pre>
<p><strong>Explica√ß√£o:</strong> Neste exemplo, a fun√ß√£o <code>load</code> acessa os par√¢metros da URL usando <code>url.searchParams.get('termo')</code>, permitindo buscar posts por t√≠tulo. Isso simula uma funcionalidade de busca baseada em query strings.</p>
<h4>Exerc√≠cios de fixa√ß√£o</h4>
<ol class="excs">
  <li>Considere os seguintes arquivos:
    <p><code>src/routes/03/[p1]/[p2]/+page.server.js</code>:</p>
    <pre><code class="language-js">export async function load({ params, url }) {
    const rp1 = params.p1;
    const rp2 = params.p2;
    const sp1 = url.searchParams.get('p1');
    const sp2 = url.searchParams.get('p2');

    return { rp1, rp2, sp1, sp2 };
}</code></pre>
    <p><code>src/routes/03/[p1]/[p2]/+page.svelte</code>:</p>
    <pre><code class="language-html">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;p&gt;Par√¢metros de rota:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;{data.rp1}&lt;/li&gt;&lt;li&gt;{data.rp2}&lt;/li&gt;&lt;/ul&gt;

&lt;p&gt;Par√¢metros de busca:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;{data.sp1}&lt;/li&gt;&lt;li&gt;{data.sp2}&lt;/li&gt;&lt;/ul&gt;</code></pre>
    <p>O que aparece na tela para cada uma das seguintes URLs?</p>
    <ol type="a">
      <li>https://meusite.com/03/uma/pagina?p1=123&amp;p2=oi</li>
      <li>https://meusite.com/03/123/oi?p1=uma&amp;p2=pagina</li>
      <li>https://meusite.com/03/outra/url?p1=td_blz&amp;p2=ok</li>
      <li>https://meusite.com/03/uma/pagina</li>
      <li>https://meusite.com/03/uma/outra/pagina</li>
      <li>https://meusite.com/03/uma/pagina?p1=123&amp;q4=567</li>
      <li>https://meusite.com/03/p1/123?p2=567</li>
    </ol>
  </li>
</ol>
<h3 id="fetch">fetch</h3>

<p>Para buscar dados de uma API externa ou de teu pr√≥prio servidor, voc√™ pode usar a fun√ß√£o <code>fetch</code> disponibilizada pelo SvelteKit. Ela se comporta de forma id√™ntica √† API nativa <code>fetch</code>, mas com algumas vantagens:</p>
<ul>
  <li>Pode ser usada para fazer requisi√ß√µes autenticadas no servidor, herdando cookies e cabe√ßalhos de autoriza√ß√£o da requisi√ß√£o da p√°gina.</li>
  <li>Requisi√ß√µes internas (como para rotas <code>+server.js</code>) s√£o redirecionadas diretamente para o manipulador de requisi√ß√µes no servidor, sem a sobrecarga de uma chamada HTTP.</li>
  <li>Em alguns casos, √© mais eficiente, pois <a target="_blank" href="https://svelte.dev/docs/kit/load#Making-fetch-requests">evita uma requisi√ß√£o adicional</a>.</li>
</ul>
<p>Crie o arquivo <code ctc>src/routes/03/external/users/+page.server.js</code>:</p>
<pre><code class="language-js">export async function load({ fetch }) {
  const res = await fetch('https://jsonplaceholder.typicode.com/users');
  const users = await res.json();
  return { users };
}</code></pre>
<p><strong>Explica√ß√£o:</strong> Esse c√≥digo faz uma requisi√ß√£o para a API externa <a target="_blank" href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a> e retorna os dados dos usu√°rios. Como est√° em <code>+page.server.js</code>, a requisi√ß√£o sempre ser√° feita no servidor, protegendo eventuais dados sens√≠veis.</p>
<p>Crie o arquivo <code ctc>src/routes/03/external/users/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h3&gt;Usu√°rios&lt;/h3&gt;
&lt;ul&gt;
  {#each data.users as user}
    &lt;li&gt;&lt;a href=&quot;/03/external/users/{user.id}&quot;&gt;{user.name}&lt;/a&gt;&lt;/li&gt;
  {/each}
&lt;/ul&gt;</code></pre>
<p><strong>Explica√ß√£o:</strong> Aqui, iteramos sobre os usu√°rios carregados e mostramos uma lista com links para cada um.</p>
<p>Agora vamos carregar as informa√ß√µes de um usu√°rios, bem como suas postagens. Crie o arquivo <code ctc>src/routes/03/external/users/[id]/+page.server.js</code>:</p>
<pre><code class="language-js">export async function load({ params, fetch }) {
  const resUser = await fetch(`https://jsonplaceholder.typicode.com/users/${params.id}`);
  const user = await resUser.json();

  const resPosts = await fetch(`https://jsonplaceholder.typicode.com/users/${params.id}/posts`);
  const posts = await resPosts.json();

  return { user, posts };
}</code></pre>
<p><strong>Explica√ß√£o:</strong> Usamos <code>params.id</code> para buscar os dados de um usu√°rio espec√≠fico e tamb√©m suas postagens. Retornamos tudo no objeto <code>data</code>.</p>
<p>Crie o arquivo <code ctc>src/routes/03/external/users/[id]/+page.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;h3&gt;User&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Nome:&lt;/strong&gt; {data.user.name}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Email:&lt;/strong&gt; {data.user.email}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Telefone:&lt;/strong&gt; {data.user.phone}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Website:&lt;/strong&gt; {data.user.website}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Companhia:&lt;/strong&gt; {data.user.company.name}&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Endere√ßo:&lt;/strong&gt; {data.user.address.street}, {data.user.address.suite}, {data.user.address.city}, {data.user.address.zipcode}&lt;/p&gt;

&lt;h3&gt;Postagens do usu√°rio&lt;/h3&gt;
&lt;ul&gt;
  {#each data.posts as post}
    &lt;li&gt;&lt;a href=&quot;/03/external/posts/{post.id}&quot;&gt;{post.title}&lt;/a&gt;&lt;/li&gt;
  {:else}
    &lt;p&gt;Esse usu√°rio n√£o postou nada ainda!&lt;/p&gt;
  {/each}
&lt;/ul&gt;
&lt;p&gt;
  &lt;a href=&quot;/03/external/users&quot;&gt;Voltar aos usu√°rios&lt;/a&gt;
&lt;/p&gt;</code></pre>
<p><strong>Explica√ß√£o:</strong></p>
<ul>
  <li>Este componente exibe os dados completos de um usu√°rio, incluindo nome, email, telefone, site, empresa e endere√ßo formatado.</li>
  <li>Abaixo das informa√ß√µes pessoais, √© exibida a lista de postagens associadas ao usu√°rio.</li>
  <li>Se o usu√°rio n√£o tiver nenhuma postagem, uma mensagem informativa ser√° exibida no lugar da lista.</li>
  <li id="post-id">Os t√≠tulos das postagens s√£o links que direcionam para a rota <code>/03/external/posts/{post.id}</code>, que ainda dever√° ser implementada.</li>
  <li>No final da p√°gina, h√° um link para retornar √† lista geral de usu√°rios.</li>
</ul>
<h2 id="pagedata">page.data</h2>

<p>O componente <code>+page.svelte</code>, assim como cada <code>+layout.svelte</code> acima dele na hierarquia, tem acesso aos seus pr√≥prios dados e tamb√©m aos dados de todos os seus layouts &quot;pais&quot;.</p>
<p>No entanto, em algumas situa√ß√µes precisamos do contr√°rio ‚Äî um layout &quot;pai&quot; pode precisar acessar dados carregados por uma p√°gina ou por um layout &quot;filho&quot;. Um exemplo comum √© o layout raiz (<code>+layout.svelte</code>) querer acessar uma propriedade <code>title</code> retornada pela fun√ß√£o <code>load</code> de um <code>+page.server.js</code>.</p>
<p>Para isso, utilizamos <a target="_blank" href="https://svelte.dev/docs/kit/$app-state#page">page.data</a>.</p>
<p><strong>Modifique</strong> o arquivo <code ctc>src/routes/03/posts/+layout.svelte</code>:</p>
<pre><code class="language-svelte">&lt;script&gt;
  import { page } from '$app/state';
  let { data, children } = $props();

  console.log(page);
&lt;/script&gt;

&lt;svelte:head&gt;
  &lt;title&gt;{page.data.post?.title || page.url.pathname}&lt;/title&gt;
&lt;/svelte:head&gt;

&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col-4 bg-body-secondary&quot;&gt;
    &lt;aside&gt;
      &lt;h4&gt;√öltimos posts&lt;/h4&gt;
      &lt;ul&gt;
        {#each data.posts.slice(0, 2) as post}
          &lt;li&gt;
            &lt;a href=&quot;/03/posts/{post.slug}&quot;&gt;
              {post.title}
            &lt;/a&gt;
          &lt;/li&gt;
        {/each}
      &lt;/ul&gt;
    &lt;/aside&gt;
  &lt;/div&gt;
  &lt;div class=&quot;col&quot;&gt;
    &lt;main&gt;
      {@render children()}
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p><strong>Explica√ß√£o:</strong> Aqui, o layout acessa <code>page.data.post?.title</code> para definir o t√≠tulo da aba dinamicamente com base na p√°gina carregada.</p>

<h4>Exerc√≠cios de fixa√ß√£o</h4>
<ol class="excs">
  <li>Considere os dois arquivos seguintes:
    <p><code>src/routes/uva/[jaca]/pera/+page.svelte</code>:</p>
    <pre><code class="language-svelte">&lt;script&gt;
  import { page } from '$app/state';
&lt;/script&gt;
{page.params.jaca}
</code></pre>
    <p><code>src/routes/uva/jaca/[pera]/+page.svelte</code>:</p>
    <pre><code class="language-svelte">&lt;script&gt;
  import { page } from '$app/state';
&lt;/script&gt;
{page.params.pera}
</code></pre>
    <p>O que aparecer√° na tela ao acessar cada uma das seguintes URLs?</p>
    <ul>
      <li>/jaca</li>
      <li>/jaca/uva/pera</li>
      <li>/uva</li>
      <li>/uva/caju/jaca</li>
      <li>/uva/figo/caqui</li>
      <li>/uva/jaca</li>
      <li>/uva/jaca/caju</li>
      <li>/uva/jaca/pera</li>
      <li>/uva/kiwi/pera</li>
      <li>/uva/pera/jaca</li>
      <li>/uva/pera/kiwi</li>
    </ul>
  </li>
</ol>

<h2 id="cliente-vs-servidor">Cliente vs Servidor</h2>

<p>Al√©m das fun√ß√µes <code>load</code> nos arquivos <code>+layout.server.js</code> e <code>+page.server.js</code>, que sempre s√£o executadas no servidor, tamb√©m existem as fun√ß√µes <code>load</code> nos arquivos <code>+layout.js</code> e <code>+page.js</code>, conhecidas como fun√ß√µes <code>load</code> universais. Essas fun√ß√µes podem ser executadas tanto no servidor quanto no navegador (a menos que sejam combinadas com <code>export const ssr = false</code>, caso em que elas ser√£o executadas <a target="_blank" href="https://svelte.dev/docs/kit/page-options#ssr">somente no navegador</a>).</p>
<p>Por padr√£o, as fun√ß√µes <code>load</code> universais s√£o executadas no servidor durante o SSR (Server-Side Rendering) quando o usu√°rio visita a p√°gina pela primeira vez. Elas ser√£o executadas novamente durante o processo de <a target="_blank" href="https://svelte.dev/docs/kit/glossary#Hydration">hidrata√ß√£o</a>, reutilizando quaisquer respostas de <a target="_blank" href="https://svelte.dev/docs/kit/load#Making-fetch-requests">requisi√ß√µes fetch</a> feitas anteriormente. Todas as invoca√ß√µes subsequentes dessas fun√ß√µes <code>load</code> universais ocorrer√£o no navegador. Voc√™ pode personalizar esse comportamento por meio das <a target="_blank" href="https://svelte.dev/docs/kit/page-options">op√ß√µes da p√°gina</a>. Por exemplo, se desativar a op√ß√£o de p√°gina <a target="_blank" href="https://svelte.dev/docs/kit/page-options#ssr">server-side rendering</a>, voc√™ estar√° criando uma SPA (Single Page Application), e todas as fun√ß√µes <code>load</code> universais ser√£o executadas no cliente.</p>
<p>Se uma rota contiver tanto fun√ß√µes <code>load</code> universais quanto fun√ß√µes <code>load</code> espec√≠ficas para o servidor, a fun√ß√£o <code>load</code> do servidor ser√° executada primeiro.</p>
<p>A fun√ß√£o <code>load</code> √© invocada em tempo de execu√ß√£o, a menos que voc√™ <a target="_blank" href="https://svelte.dev/docs/kit/page-options#prerender">pr√©-renderize</a> a p√°gina ‚Äî nesse caso, ela ser√° invocada em tempo de compila√ß√£o.</p>

<h3 id="quando-usar-cada-tipo">Quando usar o qu√™</h3>
<ul>
  <li>
    <p>Se a sua fun√ß√£o <code>load</code> deve ser executada sempre no servidor, por exemplo, quando utiliza vari√°veis de ambiente privadas ou acessa um banco de dados ou sistema de arquivos, ela deve ser colocada em um <code>+page.server.js</code>.</p>
  </li>
  <li>
    <p>Como o SvelteKit pode acessar os dados diretamente da API sem passar pelo seu servidor, se voc√™ precisar buscar dados de uma API externa e n√£o precisar de credenciais privadas, use o <code>+page.js</code>.</p>
  </li>
</ul>

<h2 id="conclus√£o">Conclus√£o</h2>

<p>O SvelteKit oferece uma s√©rie de recursos poderosos para carregar dados de maneira eficiente, seja do servidor, de APIs externas ou de fontes internas. Ao entender as diferen√ßas entre as fun√ß√µes <code>load</code> nos arquivos <code>+page.server.js</code>, <code>+layout.server.js</code>, <code>+page.js</code> e <code>+layout.js</code>, voc√™ pode otimizar o desempenho de teu aplicativo, aproveitando o que h√° de melhor em renderiza√ß√£o no servidor e no cliente. Para explorar mais sobre esses recursos e como aplic√°-los, consulte a <a target="_blank" href="https://svelte.dev/docs/kit/load">documenta√ß√£o oficial</a>.</p>

<h2 id="exerc√≠cios">Exerc√≠cios</h2>

<ol class="excs">
  <li><strong>Implemente as seguintes fun√ß√µes</strong> <a href="#postsdatabase">no arquivo <code>postsDatabase.js</code></a>, respons√°veis por manipular os dados dos posts: <ol>
      <li><code>getAll()</code>: Retorna todos os posts cadastrados.</li>
      <li><code>getByYearMonth(year, month)</code>: Retorna os posts publicados no ano e m√™s especificados.</li>
      <li><code>getBySlug(slug)</code>: Retorna o post que corresponde exatamente ao <code>slug</code> fornecido.</li>
      <li><code>getByQuery(title, content)</code>: Retorna todos os posts cujo t√≠tulo contenha a string fornecida em <code>title</code> ou cujo conte√∫do contenha a string em <code>content</code>. A busca n√£o deve diferenciar mai√∫sculas de min√∫sculas. Campos vazios, nulos ou indefinidos n√£o devem ser considerados no filtro.</li>
    </ol>
  </li>
  <li><strong>Implemente a <a href="#post-id">rota faltante</a></strong> <code class="ctc">src/routes/03/external/posts/[id]</code>, que exibe a postagem com o <code>id</code> especificado da API REST <a target="_blank" href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>.</li>
  <li><strong>Deixe seu aplicativo SvelteKit totalmente naveg√°vel.</strong> Garanta que todas as rotas criadas possam ser acessadas por meio de links. Para isso: <ul>
      <li>Crie os arquivos correspondentes indicados neste cap√≠tulo.</li>
      <li>Adicione os links ao menu de navega√ß√£o lateral.</li>
    </ul>
  </li>
  <li><strong>Consuma a API REST da <a target="_blank" href="https://pokeapi.co/">Pok√©API</a></strong> para criar uma p√°gina que liste os Pok√©mons. Cada item da lista deve conter um link para a p√°gina de detalhes do respectivo Pok√©mon.</li>
  <p><strong>Poss√≠vel solu√ß√£o:</strong></p>
  <p>Crie o arquivo <code ctc>src/routes/03/pokemon/+page.svelte</code></p>
  <pre><code class="language-svelte">&lt;script&gt;
  let { data } = $props();
&lt;/script&gt;

&lt;div class="row"&gt;
  {#each data.pokemons as p}
    &lt;div class="col-md-3 col-sm-6 mb-3"&gt;
      &lt;div class="card"&gt;
        &lt;img src={p.image} alt={p.name} class="card-img-top" /&gt;
        &lt;div class="card-body"&gt;
          &lt;a href="/03/pokemon/{p.name}" class="stretched-link text-decoration-none"&gt;
            &lt;h5 class="card-title text-capitalize"&gt;{p.name}&lt;/h5&gt;
          &lt;/a&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  {/each}
&lt;/div&gt;</code></pre>
  <p><strong>Explica√ß√£o:</strong></p>
  <ul>
    <li>O c√≥digo acima exibe uma grade de cards com os Pok√©mons listados.</li>
    <li><strong>Linha 8</strong>: Cada <a target="_blank" href="https://getbootstrap.com/docs/5.3/components/card/#images">card</a> √© colocado em uma coluna que ocupa largura 3/12 em telas m√©dias pra cima (<code>col-md-3</code>), e largura 6/12 em telas pequenas pra cima (<code>col-sm-6</code>), e ocupa 100% da largura em telas menores.</li>
    <li><strong>Linha 11:</strong> O link direciona para uma p√°gina com mais informa√ß√µes sobre o Pok√©mon.</li>
    <li><strong>Linha 11:</strong> A classe <a target="_blank" href="https://getbootstrap.com/docs/5.3/helpers/stretched-link/"><code>stretched-link</code></a> permite que a √°rea inteira do card seja clic√°vel.</li>
  </ul>
  <p><strong>Carregando os dados:</strong></p>
  <p>Crie o arquivo <code ctc>src/routes/03/pokemon/+page.js</code>:</p>
  <pre><code class="language-js">export async function load() {
  const limit = 12;
  const offset = 0;

  const res = await fetch(`https://pokeapi.co/api/v2/pokemon?offset=${offset}&limit=${limit}`);
  const data = await res.json();

  for (const pokemon of data.results) {
    const id = pokemon.url.split("/").at(-2);
    pokemon.image = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
  }

  return { pokemons: data.results };
}</code></pre>
  <p><strong>Explica√ß√£o:</strong></p>
  <ul>
    <li><strong>Linhas 2 e 3:</strong> Define os par√¢metros para buscar apenas 12 pok√©mons (<code>limit = 12</code>) a partir do in√≠cio (<code>offset = 0</code>).</li>
    <li><strong>Linha 5:</strong> Faz uma requisi√ß√£o para a Pok√©API, pedindo os 12 primeiros pok√©mons.</li>
    <li><strong>Linha 6:</strong> A resposta recebida cont√©m apenas os nomes e as URLs dos pok√©mons, sem trazer diretamente as imagens.</li>
    <li><strong>Linhas 8 a 10:</strong> Para cada pok√©mon na lista, extra√≠mos o seu ID da URL. Como a URL tem um formato como <code>https://pokeapi.co/api/v2/pokemon/6/</code>, usamos:
      <ul>
        <li><code>split("/")</code> para transformar a URL em uma lista de partes separadas por <code>/</code>;</li>
        <li><code>at(-2)</code> para acessar o pen√∫ltimo item da lista, que corresponde ao ID do pok√©mon. Isso funciona porque as URLs da Pok√©API terminam com uma barra, deixando o ID na posi√ß√£o anterior √† √∫ltima barra.</li>
      </ul>
      <p>Esse ID √© ent√£o usado para montar a URL da imagem correspondente, dispon√≠vel no reposit√≥rio da Pok√©API no GitHub como <code>https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/6.png</code></p>
    </li>

    <li><strong>Linha 13:</strong> Retorna a lista de pok√©mons (agora com imagens adicionadas) para ser utilizada pela interface do SvelteKit.</li>
  </ul>
  <p>Essa abordagem √© comum quando a API retorna informa√ß√µes parciais. Em vez de fazer uma nova requisi√ß√£o para trazer a imagem de cada pok√©mon (o que seria mais lento), deduzimos o ID e montamos a URL direto para o reposit√≥rio de imagens ‚Äî uma solu√ß√£o pr√°tica e eficiente.</p>
  <li><strong>Implemente a pagina√ß√£o</strong> para a listagem dos Pok√©mons. <p><strong>Passos sugeridos:</strong></p>
    <ol>
      <li>Exiba um n√∫mero limitado de Pok√©mons por p√°gina (ex: 20).</li>
      <li>Adicione bot√µes "Pr√≥ximo" e "Anterior" para navegar entre as p√°ginas.</li>
      <li>Ao clicar em um bot√£o de navega√ß√£o, a p√°gina ser√° atualizada com os novos itens da pr√≥xima ou da p√°gina anterior.</li>
      <li>Teste a funcionalidade para garantir que a navega√ß√£o funcione corretamente.</li>
    </ol>
  </li>
  <li><strong>Adicione uma funcionalidade de busca</strong> para filtrar Pok√©mons com base em par√¢metros de consulta (query params) (por exemplo, tipo, nome etc.).</li>
  <li><strong>Crie uma p√°gina de detalhes</strong> para cada Pok√©mon. Essa p√°gina ser√° acessada ao clicar em um Pok√©mon na lista.</li>
</ol>