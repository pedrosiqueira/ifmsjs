<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
    <script defer>hljs.configure({ languages: ["javascript"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

    <!-- https://github.com/arronhunt/highlightjs-copy -->
    <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
    <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

    <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
    <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
    <script defer>hljs.highlightLinesAll([[], [], [{ start: 4, end: 4, color: 'lightblue' }]]);    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
    <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h1 id="criando-um-projeto-sveltekit-com-capacitor-drizzle-orm-e-sqlite">Criando um projeto SvelteKit com Capacitor, Drizzle ORM e SQLite</h1>
<hr>
<h2>Criando</h2>
<p>Primeiramente abra o terminal <strong>na pasta onde deseja criar o projeto</strong>.</p>
<p>Execute os seguintes comandos:</p>
<pre><code class="sh">pnpm dlx sv create meu-projeto-capacitor
cd meu-projeto-capacitor/
pnpm add -D @capacitor/cli drizzle-kit
pnpm add @capacitor/core @capacitor/android @capacitor/filesystem drizzle-orm sql.js bootstrap bootstrap-icons
npx cap init meu-projeto-capacitor io.github.pedrosiqueira.meuProjetoCapacitor
npx cap add android
code -r .</code></pre>
<p>Quando solicitado, escolha as seguintes op√ß√µes:</p>
<pre><code class="txt">‚îå  Welcome to the Svelte CLI! (v0.7.2)
‚îÇ
‚óá  Which template would you like?
‚îÇ  SvelteKit minimal
‚îÇ
‚óá  Add type checking with TypeScript?
‚îÇ  No
‚îÇ
‚óÜ  Project created
‚îÇ
‚óá  What would you like to add to your project? (use arrow keys / space bar)
‚îÇ  prettier, eslint, sveltekit-adapter, drizzle
‚îÇ
‚óá  sveltekit-adapter: Which SvelteKit adapter would you like to use?
‚îÇ  static
‚îÇ
‚óá  drizzle: Which database would you like to use?
‚îÇ  SQLite
‚îÇ
‚óá  drizzle: Which SQLite client would you like to use?
‚îÇ  libSQL
‚îÇ
‚óÜ  Successfully setup add-ons
‚îÇ
‚óá  Which package manager do you want to install dependencies with?
‚îÇ  pnpm</code></pre>
<p>Quando solicitado <code>? Create free Ionic account? ¬ª (Y/n)</code>, digite <kbd>n</kbd>.</p>
<hr>
<h2 id="preparando-para-instalar-o-app-no-celular-ou-emulador">Configurando</h2>
<ol>
    <li>
        <p>No arquivo <code>capacitor.config.json</code>, altere o valor da propriedade <code>"webDir"</code> para <code>"build"</code>:</p>
        <pre><code class="json">{
  "appId": "io.github.pedrosiqueira.svelteCapacitorDrizzleSqlite",
  "appName": "svelte-capacitor-drizzle-sqlite",
  "webDir": "build"
}</code></pre>
    </li>
    <li>
        <p>Crie ou edite o arquivo <code>src/routes/+layout.js</code>, adicionando as seguintes linhas:</p>
        <pre><code>export const prerender = true;
export const ssr = false;</code></pre>
    </li>
</ol>
<hr>

<h2 id="estrutura-t-pica-de-um-app-com-capacitor">Estrutura t√≠pica de um projeto com Capacitor</h2>
<pre><code class="txt">üìÅ projeto/
‚îú‚îÄ‚îÄ build/                ‚Üê Arquivos gerados pelo build do SvelteKit
‚îú‚îÄ‚îÄ capacitor.config.json ‚Üê Arquivo de configura√ß√£o do Capacitor
‚îú‚îÄ‚îÄ android/              ‚Üê Projeto Android com WebView embutida
‚îú‚îÄ‚îÄ ios/                  ‚Üê Projeto iOS com WebView embutida
‚îú‚îÄ‚îÄ src/                  ‚Üê C√≥digo-fonte do aplicativo</code></pre>

<hr />

<h2>Explica√ß√£o dos comandos</h2>
<hr>
<pre><code>pnpm dlx sv create meu-projeto-capacitor</code></pre>
<ul>
    <li>Usa <code>pnpm dlx</code> para rodar o comando <strong>sem instalar globalmente</strong>.</li>
    <li><code>sv create meu-projeto-capacitor</code> ‚Üí Cria um novo projeto <strong>Svelte</strong><foot-note href="https://svelte.dev/docs/kit/creating-a-project"></foot-note> chamado <code>meu-projeto-capacitor</code>.</li>
</ul>
<hr>
<pre><code>cd meu-projeto-capacitor/</code></pre>
<ul>
    <li>Entra no diret√≥rio do projeto rec√©m-criado.</li>
</ul>
<hr>
<pre><code>pnpm add -D @capacitor/cli drizzle-kit</code></pre>
<ul>
    <li>Instala como <strong>depend√™ncia de desenvolvimento (<code>-D</code>)</strong>:
        <ul>
            <li><code>@capacitor/cli</code> ‚Üí CLI do Capacitor<foot-note href="https://capacitorjs.com/docs/getting-started"></foot-note> (para gerar builds e rodar comandos).</li>
            <li><code>drizzle-kit</code> ‚Üí Ferramenta para gera√ß√£o e migra√ß√£o de banco de dados Drizzle<foot-note href='https://orm.drizzle.team/docs/kit-overview'></foot-note>.</li>
        </ul>
    </li>
</ul>
<p>(Essas depend√™ncias s√£o usadas apenas durante o desenvolvimento, e n√£o s√£o inclu√≠das na vers√£o final do aplicativo.)</p>
<hr>
<pre><code>pnpm add @capacitor/core @capacitor/android @capacitor/filesystem drizzle-orm sql.js bootstrap bootstrap-icons</code></pre>
<ul>
    <li>Instala como <strong>depend√™ncia do projeto</strong>:
        <ul>
            <li><code>@capacitor/core</code> ‚Üí Core do Capacitor<foot-note href="https://capacitorjs.com/docs/getting-started"></foot-note>, necess√°rio para qualquer app Capacitor.</li>
            <li><code>@capacitor/android</code> ‚Üí Plugin para gerar um app Android<foot-note href='https://capacitorjs.com/docs/android'></foot-note>.</li>
            <li><code>@capacitor/filesystem</code> ‚Üí API do Capacitor para manipular arquivos<foot-note href="https://capacitorjs.com/docs/apis/filesystem"></foot-note> (√∫til para SQLite).</li>
            <li><code>drizzle-orm</code> ‚Üí Biblioteca ORM para manipula√ß√£o de banco de dados<foot-note href='https://orm.drizzle.team/docs/get-started-sqlite'></foot-note>.</li>
            <li><code>sql.js</code> ‚Üí Biblioteca que permite rodar SQLite na mem√≥ria via WebAssembly<foot-note href='https://sql.js.org/'></foot-note>.</li>
            <li><code>bootstrap</code> ‚Üí Framework CSS para estiliza√ß√£o<foot-note href='https://getbootstrap.com/docs/5.3/getting-started/download/#npm'></foot-note>.</li>
            <li><code>bootstrap-icons</code> ‚Üí √çcones do Bootstrap<foot-note href='https://icons.getbootstrap.com/#install'></foot-note>.</li>
        </ul>
    </li>
</ul>
<p>(Essas depend√™ncias no c√≥digo em tempo de execu√ß√£o (produ√ß√£o), e s√£o inclu√≠das na vers√£o final do aplicativo.)</p>
<hr>
<p>(altere para o teu nome de usu√°rio do GitHub...)</p>
<pre><code>npx cap init meu-projeto-capacitor io.github.pedrosiqueira.meuProjetoCapacitor</code></pre>
<ul>
    <li>Inicializa o <strong>Capacitor</strong> no projeto.</li>
    <li>Exig√™ncias para desenvolvimento de aplicativos Android:
        <ul>
            <li>Define o nome do app (<code>meu-projeto-capacitor</code>).</li>
            <li>Define o <strong>ID do pacote</strong> (<code>io.github.pedrosiqueira.meuProjetoCapacitor</code>), que ser√° usado na Play Store/App Store.</li>
        </ul>
    </li>
</ul>
<hr>
<pre><code>npx cap add android</code></pre>
<ul>
    <li>Adiciona a <strong>plataforma Android</strong> ao projeto Capacitor.</li>
    <li>Cria a pasta <code>android/</code>, onde o c√≥digo nativo ser√° gerado.</li>
</ul>
<hr>
<pre><code>code -r .</code></pre>
<ul>
    <li>Abre o projeto no <strong>VS Code</strong> (<code>.</code> significa abrir a pasta atual).</li>
    <li><code>-r</code> (reutilizar) ‚Üí Se j√° houver uma inst√¢ncia aberta do VS Code, abre o projeto nela.</li>
</ul>
<hr>
<h2 id="resumo-do-que-acontece"><strong>Resumo</strong></h2>

<ol type="1">
    <li>Cria um projeto Svelte.</li>
    <li>Instala o Capacitor e Drizzle ORM.</li>
    <li>Adiciona SQLite via <code>sql.js</code>.</li>
    <li>Prepara o Capacitor para Android.</li>
    <li>Abre o projeto no VS Code.</li>
</ol>
<p>Agora o projeto est√° pronto para desenvolvimento com <strong>Svelte + Capacitor + Drizzle ORM + SQLite</strong>!</p>
<hr>
<h2>Explica√ß√£o da Configura√ß√£o</h2>
<hr>
<h3>1. Local do Build</h3>
<p>Por padr√£o, o CapacitorJS espera que os arquivos do projeto constru√≠do estejam na pasta <code>dist</code>. No entanto, projetos criados com Svelte (via <code>vite build</code>) geram os arquivos finais na pasta <code>build</code>.</p>
<p>Para que o Capacitor localize corretamente os arquivos do app, √© necess√°rio modificar a propriedade <code>"webDir"</code> no arquivo <code>capacitor.config.json</code> para <code>"build"</code>.</p>
<hr>
<h3>2. Op√ß√µes de P√°gina</h3>
<p>Ao usar Capacitor, estamos trabalhando com HTML, CSS e JavaScript executados dentro de um <strong>WebView</strong> ‚Äî sem um servidor back-end. O app √© carregado a partir de arquivos <strong>est√°ticos</strong>, o que significa que toda a l√≥gica precisa ser executada no lado do cliente. Isso caracteriza uma <a href="https://svelte.dev/docs/kit/single-page-apps" target="_blank">SPA (Single Page Application)</a> ‚Äî ou seja, um aplicativo em que todo o conte√∫do √© carregado dinamicamente sem recarregamento de p√°gina.</p>
<hr>
<h4>Op√ß√£o <code>prerender</code></h4>
<p>No SvelteKit, para tornar o app em um SPA, usamos o adaptador est√°tico (configurado na cria√ß√£o do projeto) e <a target="_blank" href="https://svelte.dev/docs/kit/page-options#prerender">adicionamos</a> <code>export const prerender = true;</code> no arquivo <code>src/routes/+layout.js</code>.</p>
<p>Isso garante que todas as p√°ginas sejam pr√©-renderizadas de antem√£o durante o build (tempo de compila√ß√£o), e n√£o sob demanda durante a execu√ß√£o (tempo de execu√ß√£o) ‚Äî gerando arquivos HTML e JS est√°ticos prontos para serem usados, sem necessidade de um servidor back-end em tempo real.</p>

<p>Nem todas as p√°ginas podem ser pr√©-renderizadas. <a href="https://svelte.dev/docs/kit/glossary#prerendering" target="_blank">A regra b√°sica √©:</a> o conte√∫do deve ser o mesmo para qualquer usu√°rio que acesse diretamente a p√°gina, e ela n√£o deve conter <a target="_blank" href="https://svelte.dev/docs/kit/form-actions">form actions</a>. No nosso caso, isso n√£o ser√° um problema, pois n√£o escreveremos c√≥digo que dependa de back-end.</p>
<hr>
<h4>Op√ß√£o <code>ssr</code></h4>
<p>Mesmo com a op√ß√£o <code>prerender</code>, o SvelteKit ainda executaria o JavaScript dos componentes no servidor antes de envi√°-lo ao cliente ‚Äî processo conhecido como <a href="https://svelte.dev/docs/kit/page-options" target="_blank">hidrata√ß√£o</a>.</p>
<p>No entanto, como utilizaremos o Bootstrap, que acessa objetos do DOM (como <code>document</code> ou <code>window</code>), que n√£o est√£o dispon√≠veis no lado do servidor, precisamos impedir essa execu√ß√£o no servidor. Para isso, <a target="_blank" href="https://svelte.dev/docs/kit/page-options#ssr">adicionamos</a> <code>export const ssr = false;</code> no arquivo <code>src/routes/+layout.js</code>, garantindo que tudo seja executado exclusivamente no cliente.</p>
<hr>
<h3>Resumo</h3>
<ul>
    <li>Com <code>"webDir": "build"</code>, o app abre a WebView e carrega os arquivos da pasta <code>build/</code>.</li>
    <li>Com <code>prerender = true</code>, a p√°gina ser√° gerada como HTML est√°tico no momento do build.</li>
    <li>Com <code>ssr = false</code>, toda a l√≥gica e renderiza√ß√£o ser√° feita no lado do cliente.</li>
</ul>
<p>Essa abordagem √© ideal para <strong>SPAs (Single Page Applications)</strong> sem necessidade de SSR (Server-Side Rendering).</p>
<hr>