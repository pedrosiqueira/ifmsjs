<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://unpkg.com/highlightjs-svelte/dist/svelte.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
    <script defer>hljs.configure({ languages: ["svelte"] }); hljs.highlightAll(); hljs.initLineNumbersOnLoad();</script>

    <!-- https://github.com/arronhunt/highlightjs-copy -->
    <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
    <script defer>hljs.addPlugin(new CopyButtonPlugin());</script>

    <!-- https://github.com/TRSasasusu/highlightjs-highlight-lines.js -->
    <script src="https://cdn.jsdelivr.net/gh/TRSasasusu/highlightjs-highlight-lines.js@1.2.0/highlightjs-highlight-lines.min.js"></script>
    <script defer>hljs.highlightLinesAll([[], [], [], [{ start: 4, end: 4, color: 'lightblue' }]]);    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.css">
    <script src="https://cdn.jsdelivr.net/gh/pedrosiqueira/custom-style/custom.min.js"></script>
</head>

<h1>Criando um projeto SvelteKit com Capacitor, Drizzle ORM e SQLite</h1>
<hr>
<h2>Criando</h2>
<ol>
    <li>
        <p>Primeiramente abra o terminal <strong>na pasta onde deseja criar o projeto</strong>.</p>
    </li>
    <li>
        <p>Execute os seguintes comandos: (alterando o trecho <code>pedrosiqueira</code> da linha 5 para o teu nome de usu√°rio do GitHub...)</p>
        <pre><code class="sh">pnpm dlx sv create meu-projeto-capacitor
cd meu-projeto-capacitor/
pnpm add -D @capacitor/cli drizzle-kit
pnpm add @capacitor/core @capacitor/android @capacitor/filesystem drizzle-orm sql.js bootstrap bootstrap-icons
npx cap init meu-projeto-capacitor io.github.pedrosiqueira.meuProjetoCapacitor
npx cap add android
code -r .</code></pre>
    </li>
    <li>
        <p>Quando solicitado, escolha as seguintes op√ß√µes:</p>
        <pre><code class="txt">‚îå  Welcome to the Svelte CLI! (v0.7.2)
‚îÇ
‚óá  Which template would you like?
‚îÇ  SvelteKit minimal
‚îÇ
‚óá  Add type checking with TypeScript?
‚îÇ  No
‚îÇ
‚óÜ  Project created
‚îÇ
‚óá  What would you like to add to your project? (use arrow keys / space bar)
‚îÇ  prettier, eslint, sveltekit-adapter, drizzle
‚îÇ
‚óá  sveltekit-adapter: Which SvelteKit adapter would you like to use?
‚îÇ  static
‚îÇ
‚óá  drizzle: Which database would you like to use?
‚îÇ  SQLite
‚îÇ
‚óá  drizzle: Which SQLite client would you like to use?
‚îÇ  libSQL
‚îÇ
‚óÜ  Successfully setup add-ons
‚îÇ
‚óá  Which package manager do you want to install dependencies with?
‚îÇ  pnpm</code></pre>
    </li>
    <li>
        <p>Quando solicitado <code>? Create free Ionic account? ¬ª (Y/n)</code>, digite <kbd>n</kbd>.</p>
    </li>
</ol>
<hr>
<h3>Explica√ß√£o dos comandos</h3>
<ol>
    <li>
        <p><code class="sh">pnpm dlx sv create meu-projeto-capacitor</code></p>
        <ul>
            <li>Usa <code>pnpm dlx</code> para rodar o comando <strong>sem instalar globalmente</strong>.</li>
            <li><code>sv create meu-projeto-capacitor</code> ‚Üí Cria um novo projeto <strong>Svelte</strong><foot-note href="https://svelte.dev/docs/kit/creating-a-project"></foot-note> chamado <code>meu-projeto-capacitor</code>.</li>
        </ul>
    </li>
    <li>
        <p><code class="sh">cd meu-projeto-capacitor/</code></p>
        <ul>
            <li>Entra no diret√≥rio do projeto rec√©m-criado.</li>
        </ul>
    </li>
    <li>
        <p><code class="sh">pnpm add -D @capacitor/cli drizzle-kit</code></p>
        <ul>
            <li>Instala como <strong>depend√™ncia de desenvolvimento (<code>-D</code>)</strong>:
                <ul>
                    <li><code>@capacitor/cli</code> ‚Üí CLI do Capacitor<foot-note href="https://capacitorjs.com/docs/getting-started"></foot-note> (para gerar builds e rodar comandos).</li>
                    <li><code>drizzle-kit</code> ‚Üí Ferramenta para gera√ß√£o e migra√ß√£o de banco de dados Drizzle<foot-note href='https://orm.drizzle.team/docs/kit-overview'></foot-note>.</li>
                </ul>
            </li>
            <li>(Essas depend√™ncias s√£o usadas apenas durante o desenvolvimento, e n√£o s√£o inclu√≠das na vers√£o final do aplicativo.)</li>
        </ul>
    </li>
    <li>
        <p><code class="sh">pnpm add @capacitor/core @capacitor/android @capacitor/filesystem drizzle-orm sql.js bootstrap bootstrap-icons</code></p>
        <ul>
            <li>Instala como <strong>depend√™ncia do projeto</strong>:
                <ul>
                    <li><code>@capacitor/core</code> ‚Üí Core do Capacitor<foot-note href="https://capacitorjs.com/docs/getting-started"></foot-note>, necess√°rio para qualquer app Capacitor.</li>
                    <li><code>@capacitor/android</code> ‚Üí Plugin para gerar um app Android<foot-note href='https://capacitorjs.com/docs/android'></foot-note>.</li>
                    <li><code>@capacitor/filesystem</code> ‚Üí API do Capacitor para manipular arquivos<foot-note href="https://capacitorjs.com/docs/apis/filesystem"></foot-note> (√∫til para SQLite).</li>
                    <li><code>drizzle-orm</code> ‚Üí Biblioteca ORM para manipula√ß√£o de banco de dados<foot-note href='https://orm.drizzle.team/docs/get-started-sqlite'></foot-note>.</li>
                    <li><code>sql.js</code> ‚Üí Biblioteca que permite rodar SQLite na mem√≥ria via WebAssembly<foot-note href='https://sql.js.org/'></foot-note>.</li>
                    <li><code>bootstrap</code> ‚Üí Framework CSS para estiliza√ß√£o<foot-note href='https://getbootstrap.com/docs/5.3/getting-started/download/#npm'></foot-note>.</li>
                    <li><code>bootstrap-icons</code> ‚Üí √çcones do Bootstrap<foot-note href='https://icons.getbootstrap.com/#install'></foot-note>.</li>
                </ul>
            </li>
            <li>(Essas depend√™ncias s√£o usadas no c√≥digo em tempo de execu√ß√£o (produ√ß√£o), e s√£o inclu√≠das na vers√£o final do aplicativo.)</li>
        </ul>
    </li>
    <li>
        <p><code class="sh">npx cap init meu-projeto-capacitor io.github.pedrosiqueira.meuProjetoCapacitor</code></p>
        <ul>
            <li>Inicializa o <strong>Capacitor</strong> no projeto.</li>
            <li>Exig√™ncias para desenvolvimento de aplicativos Android:
                <ul>
                    <li>Define o nome do app (<code>meu-projeto-capacitor</code>).</li>
                    <li>Define o <strong>ID do pacote</strong> (<code>io.github.pedrosiqueira.meuProjetoCapacitor</code>), que ser√° usado na Play Store/App Store.</li>
                </ul>
            </li>
        </ul>
    </li>
    <li>
        <p><code class="sh">npx cap add android</code></p>
        <ul>
            <li>Adiciona suporte √† <strong>plataforma Android</strong> no projeto Capacitor.</li>
            <li>Cria a pasta <code>android/</code>, onde o c√≥digo nativo ser√° gerado.</li>
        </ul>
    </li>
    <li>
        <p><code class="sh">code -r .</code></p>
        <ul>
            <li>Abre o projeto no <strong>VS Code</strong> (<code>.</code> significa abrir a pasta atual).</li>
            <li><code>-r</code> (reutilizar) ‚Üí Se j√° houver uma inst√¢ncia aberta do VS Code, abre o projeto nela.</li>
        </ul>
    </li>
</ol>
<hr>
<h3>Resumo</h3>
<ol>
    <li>Cria um projeto Svelte.</li>
    <li>Instala o Capacitor e Drizzle ORM.</li>
    <li>Adiciona SQLite via <code>sql.js</code>.</li>
    <li>Prepara o Capacitor para Android.</li>
    <li>Abre o projeto no VS Code.</li>
</ol>
<p>Agora o projeto est√° pronto para desenvolvimento com <strong>Svelte + Capacitor + Drizzle ORM + SQLite</strong>!</p>
<hr>
<h2>Estrutura t√≠pica de um projeto com Capacitor</h2>
<p>Um projeto Capacitor com SvelteKit possui a seguinte estrutura:</p>
<pre><code class="txt">üìÅ projeto/
‚îú‚îÄ‚îÄ build/                ‚Üê Arquivos gerados pelo build do SvelteKit
‚îú‚îÄ‚îÄ capacitor.config.json ‚Üê Arquivo de configura√ß√£o do Capacitor
‚îú‚îÄ‚îÄ android/              ‚Üê Projeto Android com WebView embutida
‚îú‚îÄ‚îÄ ios/                  ‚Üê Projeto iOS com WebView embutida
‚îú‚îÄ‚îÄ src/                  ‚Üê C√≥digo-fonte do aplicativo</code></pre>
<hr />
<h2>Configurando</h2>
<hr>
<h3>1. Diret√≥rio Web</h3>
<p>No arquivo <code>capacitor.config.json</code>, altere o valor da propriedade <code>"webDir"</code> para <code>"build"</code>:</p>
<pre><code class="json">{
  "appId": "io.github.pedrosiqueira.svelteCapacitorDrizzleSqlite",
  "appName": "svelte-capacitor-drizzle-sqlite",
  "webDir": "build"
}</code></pre>
<hr>
<h3>2. Op√ß√µes de P√°gina</h3>
<p>Crie o arquivo <code ctc>src/routes/+layout.js</code> com o seguinte conte√∫do:</p>
<pre><code class="js">export const prerender = true;
export const ssr = false;</code></pre>
<hr>
<h3>3. Importa√ß√£o do Bootstrap</h3>
<p>Crie o arquivo <code ctc>src/routes/+layout.svelte</code> com o seguinte conte√∫do:</p>
<pre><code>&lt;script&gt;
    import 'bootstrap/dist/css/bootstrap.css';
    import 'bootstrap-icons/font/bootstrap-icons.css';
    import * as bootstrap from 'bootstrap';

    let { children } = $props();
&lt;/script&gt;

{@render children()}</code></pre>
<hr>
<h3>Explica√ß√£o da Configura√ß√£o</h3>
<h4>1. Diret√≥rio Web</h4>
<p>Por padr√£o, o CapacitorJS espera que os arquivos do projeto constru√≠do estejam na pasta <code>dist</code>. No entanto, projetos criados com Svelte (via <code>vite build</code>) geram os arquivos finais na pasta <code>build</code>.</p>
<p>Para que o Capacitor localize corretamente os arquivos do app, √© necess√°rio alterar a propriedade <code>"webDir"</code> no arquivo <code>capacitor.config.json</code> para <code>"build"</code>.</p>
<h4>2. Op√ß√µes de P√°gina</h4>

<p>Como nosso aplicativo ser√° executado com o Capacitor, n√£o utilizaremos um servidor back-end. Toda a l√≥gica ser√° processada no lado do cliente. O app ser√° executado inteiramente dentro de um <strong>WebView</strong>, utilizando apenas HTML, CSS e JavaScript carregados a partir de arquivos <strong>est√°ticos</strong> gerados no momento do build.</p>

<ol>
    <li>
        <p><strong>Op√ß√£o <code>prerender</code>: pr√©-renderiza√ß√£o das p√°ginas.</strong></p>

        <p>O SvelteKit oferece suporte a <a target="_blank" href="https://svelte.dev/docs/kit/adapter-static">Static Site Generation (SSG)</a>, permitindo que todo o site seja compilado como uma cole√ß√£o de arquivos HTML e JS est√°ticos, prontos para serem servidos sem necessidade de um servidor din√¢mico.</p>

        <p>Para isso, usamos o adaptador est√°tico (adicionado na cria√ß√£o do projeto) e <a target="_blank" href="https://svelte.dev/docs/kit/page-options#prerender">adicionamos</a> <code>export const prerender = true;</code> no arquivo <code>src/routes/+layout.js</code>.</p>

        <p>Assim, garantimos que todas as p√°ginas sejam geradas antecipadamente durante o processo de build (tempo de compila√ß√£o)‚Äî e n√£o sob demanda durante a execu√ß√£o (tempo de execu√ß√£o) ‚Äî o que √© ideal para aplicativos que rodam completamente offline.</p>

        <p>Vale lembrar que nem todas as p√°ginas podem ser pr√©-renderizadas. <a target="_blank" href="https://svelte.dev/docs/kit/glossary#prerendering">De forma geral</a>, apenas p√°ginas cujo conte√∫do seja o mesmo para qualquer usu√°rio e que n√£o dependam de <a target="_blank" href="https://svelte.dev/docs/kit/form-actions">form actions</a> podem ser inclu√≠das nesse processo. No nosso caso, como o app √© 100% client-side e n√£o depende de back-end, isso n√£o ser√° um problema.</p>
    </li>
    <li>
        <p><strong>Op√ß√£o <code>ssr</code>: desabilitando a renderiza√ß√£o no servidor.</strong></p>

        <p>Mesmo com <code>prerender</code> ativado, o SvelteKit ainda tentaria executar o JavaScript dos componentes no servidor antes de envi√°-los ao cliente ‚Äî um processo conhecido como <a href="https://svelte.dev/docs/kit/page-options" target="_blank">hidrata√ß√£o</a>.</p>

        <p>Por√©m, como utilizaremos o Bootstrap, que depende de objetos do DOM (como <code>window</code> e <code>document</code>), √© necess√°rio impedir qualquer execu√ß√£o no servidor, j√° que essas APIs n√£o est√£o dispon√≠veis fora do ambiente do navegador.</p>

        <p>Para isso, <a target="_blank" href="https://svelte.dev/docs/kit/page-options#ssr">adicionamos</a> <code>export const ssr = false;</code> no arquivo <code>src/routes/+layout.js</code>.</p>

        <p>Assim, garantimos que todo o JavaScript seja executado exclusivamente no cliente, evitando erros relacionados ao uso do DOM no servidor.</p>
    </li>
</ol>
<p>Essas duas op√ß√µes juntas transformam nosso app em um <a href="https://svelte.dev/docs/kit/single-page-apps" target="_blank">SPA (Single Page Application)</a>, onde o conte√∫do √© carregado dinamicamente sem recarregamento de p√°gina, perfeito para o funcionamento offline com Capacitor.</p>
<h4>3. Importa√ß√£o do Bootstrap</h4>
<p>Como nosso app com Capacitor ser√° executado totalmente offline, √© essencial que todos os recursos necess√°rios estejam dispon√≠veis localmente ‚Äî sem depender de CDNs. Por isso, instalamos o pacote do Bootstrap e sua biblioteca de √≠cones no momento da cria√ß√£o do projeto.</p>
<p>Tamb√©m criamos o arquivo <code>+layout.svelte</code>, que serve como componente de layout global, o que significa que qualquer importa√ß√£o ou funcionalidade inserida nele estar√° dispon√≠vel para todas as p√°ginas do app.</p>
<p>Nele, importamos os estilos do Bootstrap, os √≠cones via <code>bootstrap-icons</code>, e a biblioteca JavaScript do Bootstrap para uso de componentes din√¢micos como modais e tooltips.</p>
<hr>
<h3>Resumo</h3>
<ul>
    <li>Com <code>"webDir": "build"</code>, o app abre a WebView e carrega os arquivos da pasta <code>build/</code>.</li>
    <li>Com <code>prerender = true</code>, a p√°gina ser√° gerada como HTML est√°tico no momento do build.</li>
    <li>Com <code>ssr = false</code>, toda a l√≥gica e renderiza√ß√£o ser√° feita no lado do cliente.</li>
    <li>Com as importa√ß√µes do Bootsrap, o visual e os comportamentos interativos do Bootstrap funcionem corretamente em todo o app, mesmo sem conex√£o com a internet.</li>
</ul>
<p>Essa abordagem √© ideal para <strong>SPAs (Single Page Applications)</strong> sem necessidade de SSR (Server-Side Rendering).</p>
<hr>